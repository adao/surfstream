function setSuggestions(a){var b=_.pluck(a[1],0);window.SurfStreamApp.get("mainView").sideBarView.videoManagerView.browseVideosView.searchView.suggestionHash[a[0]]=b,$("#youtubeInput").autocomplete("option","source",b)}function nextFDVideo(){console.log("next fd");var a={videos:[{videoId:"bzE-IMaegzQ",startTime:77},{videoId:"-BrDlrytgm8",startTime:30},{videoId:"lI7H7ForuwA",startTime:75},{videoId:"Z7vXP3tHzhA",startTime:4},{videoId:"wC6DuckeJUM",startTime:24},{videoId:"ess9bRJ0bPw",startTime:7},{videoId:"L64c5vT3NBw",startTime:37},{videoId:"AEPvSo8bE2I",startTime:2},{videoId:"zE0IzAsIVWk",startTime:560},{videoId:"CwmtkFPYXsg",startTime:30},{videoId:"k8w-qZEiNsY",startTime:38},{videoId:"n9APqLA2YKs",startTime:3},{videoId:"PQMJCOT2wlQ",startTime:55},{videoId:"Xe0gIFxYhrk",startTime:30},{videoId:"_8yGGtVKrD8",startTime:230},{videoId:"p3tZPH5my-0",startTime:47},{videoId:"Vw4KVoEVcr0",startTime:28},{videoId:"quwebVjAEJA",startTime:42},{videoId:"d6Vqp6UveIU",startTime:188},{videoId:"JnCiTSzYHRM",startTime:20},{videoId:"8WPtEGOp5rI",startTime:16},{videoId:"kYSoy71ib7A",startTime:13},{videoId:"NEmDHO9rLGY",startTime:0},{videoId:"cFAGUAl8lxE",startTime:124},{videoId:"6PKQE8FM2Uw",startTime:28},{videoId:"XKcChGsDqnU",startTime:8},{videoId:"o0oHlX8Kmxk",startTime:22},{videoId:"miaAC3d4RDU",startTime:5},{videoId:"JOl4vwhwkW8",startTime:60},{videoId:"T36A-H8dPhI",startTime:80},{videoId:"WEh0JoSki-Y",startTime:27},{videoId:"RsnQxdPhskI",startTime:39},{videoId:"l3m9kBzdA34",startTime:8},{videoId:"dPLWKBWkn3s",startTime:108},{videoId:"yoOwCSgvNs0",startTime:10},{videoId:"JhlfT-x6Ys0",startTime:14},{videoId:"vwy47ZzR780",startTime:4},{videoId:"cMkimxS_swA",startTime:14},{videoId:"YyqEjatCSe0",startTime:10},{videoId:"0-1D_MJzsNU",startTime:8},{videoId:"U8vvhGixWQQ",startTime:18},{videoId:"dTHWBSluUjU",startTime:85},{videoId:"RgFVlkGw7XY",startTime:20},{videoId:"uSEZ8cgGHgo",startTime:25},{videoId:"j2odOu0Oguo",startTime:5},{videoId:"XkclYFNBbpA",startTime:0},{videoId:"YZEbBZ2IrXE",startTime:5}]};window.fdplayer=document.getElementById("YouTubePlayer-fd"),console.log(window.ss_loopOrder),console.log(window.ss_loopIndex),window.fdplayer.loadVideoById(a.videos[window.ss_loopOrder[window.ss_loopIndex]].videoId,a.videos[window.ss_loopOrder[window.ss_loopIndex]].startTime),window.ss_loopIndex<a.videos.length-1?window.ss_loopIndex=window.ss_loopIndex+1:window.ss_loopIndex=0}function fisherYates(a){var b=a.length;if(b==0)return!1;while(--b){var c=Math.floor(Math.random()*(b+1)),d=a[b],e=a[c];a[b]=e,a[c]=d}}function onYouTubePlayerReady(a){if(a=="YouTubePlayerTwo"){window.YTPlayerTwo=document.getElementById("YouTubePlayerTwo");return}if(a=="YouTubePlayer-fd"){var b=46;window.fdplayer=document.getElementById("YouTubePlayer-fd"),window.ss_loopOrder=new Array;for(var c=0;c<b+1;c++)window.ss_loopOrder[c]=c;fisherYates(window.ss_loopOrder),window.ss_loopIndex=0,nextFDVideo(),window.ss_fdLoop=setInterval("nextFDVideo()",14e3)}window.YTPlayer||(window.YTPlayer=document.getElementById("YouTubePlayer"),window.YTPlayer.addEventListener("onStateChange","onytplayerStateChange"),window.playerLoaded=!0,window.video_ID&&(window.YTPlayer.loadVideoById(window.video_ID,window.secs),new ChatCellVideoView({username:"Now Playing: ",videoID:window.video_ID,videoTitle:window.video_title})))}function setToTime(){window.YTPlayer=document.getElementById("YouTubePlayer"),window.YTPlayer.addEventListener("onStateChange","onytplayerStateChange"),window.YTPlayer.seekTo(window.secs)}function setVideoVolume(a){var b=window.YTPlayer.getVolume();b+a.data.offset>=0&&b+a.data.offset<=100&&window.YTPlayer.setVolume(b+a.data.offset)}function mute(a){window.YTPlayer.isMuted()?window.YTPlayer.unMute():window.YTPlayer.mute()}function onytplayerStateChange(a){}function ss_formatSeconds(a){var b=null,c=null,d=null,e;return a=Math.floor(a),b=Math.floor(a/3600),a=a-b*3600,c=Math.floor(a/60),d=a-c*60,e=""+(b>0?b+":":"")+(c>0?c<10&&b>0?"0"+c+":":c+":":"0:")+(d<10?"0"+d:d),e}function ss_idToImg(a){return"http://img.youtube.com/vi/"+a+"/0.jpg"}function ss_idToHDImg(a){return"http://i1.ytimg.com/vi/"+a+"/hqdefault.jpg"}function ss_modelWithAttribute(a,b,c){for(var d=0;d<a.length;d++)if(a.at(d).get(b)==c)return a.at(d);return null}function updateTime(){window.YTPlayer&&($("#countdownFull").html(ss_formatSeconds(window.YTPlayer.getDuration()-window.YTPlayer.getCurrentTime())),window.YTPlayer.getDuration()-window.YTPlayer.getCurrentTime()!=0&&($("#cur-video-time").html(ss_formatSeconds(window.YTPlayer.getDuration()-window.YTPlayer.getCurrentTime())),$("#time-elapsed-bar").css({width:635*(window.YTPlayer.getCurrentTime()/window.YTPlayer.getDuration())+"px"})))}function skipVideo(){$("#skipContainer").remove(),socket_init.emit("video:skip")}function strip(a){var b=document.createElement("DIV");return b.innerHTML=a,b.textContent||b.innerText}function ss_formatViews(a){var b=""+a,c=Math.abs(a),d,e;return c>=1e3&&(d=(""+c).split(/\./),e=d[0].length%3||3,d[0]=b.slice(0,e+(a<0))+d[0].slice(e).replace(/(\d{3})/g,",$1"),b=d.join(".")),b}window.fbAsyncInit=function(){function c(a){var b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return a.match(b)}function e(){if(!window.fdPlayerLoading){var a={wmode:"opaque",allowScriptAccess:"always",iv_load_policy:3},b={id:"YouTubePlayer-fd"};swfobject.embedSWF("http://www.youtube.com/apiplayer?version=3&enablejsapi=1&playerapiid=YouTubePlayer-fd","ytfd","640","390","8",null,null,a,b),window.fdPlayerLoading=!0}}function f(){document.getElementById("frontdoor").style.display="none",document.getElementById("loadingScreen").style.display="none",document.getElementById("outer").style.display="block"}function g(){document.getElementById("loadingScreen").style.display="none",document.getElementById("outer").style.display="none",document.getElementById("frontdoor").style.display="inline-block"}function h(a){if(a.authResponse){var b=a;FB.api("/me",function(a){var c;socket_init.emit("surfstream:login",{fbId:b.authResponse.userID,promo:$("#promoBox").val(),email:a.email}),window.logged_in_fb_user=a;if(typeof mpq!="undefined"){mpq.name_tag(a.name),mpq.identify(b.authResponse.userID);var d={};a.gender&&(d.gender=a.gender),a.locale&&(d.locale=a.locale),mpq.register(d)}})}else e(),g()}var a=$("#fba_ss_id").html();FB.init({appId:a,status:!0,cookie:!0,xfbml:!0,oauth:!0}),$("#fb-auth").click(function(){FB.login(h,{scope:"email,read_stream"})}),$("#fb-auth-new").click(function(){return window.promoApproved&&FB.login(h,{scope:"email,read_stream"}),!1});var b=$("#promoBox");b.keyup(function(a){window.promoLoop&&clearTimeout(window.promoLoop),console.log("New setTimout..."),window.promoLoop=setTimeout(function(){console.log("validating promo"),socket_init.emit("promo:validate",{promo:$("#promoBox").val()})},800)}),$("#submitEmail").bind("click",function(){var a=$("#emailBox").val(),b=c(a);if(b){$("#emailBox").css("background","white");if(window.logged_in_user){var d=window.logged_in_user.userID;socket_init.emit("surfstream:requestPromo",{email:a,fbId:d})}else socket_init.emit("surfstream:requestPromo",{email:a})}else $("#emailBox").css("background","#FAAFAF");return!1}),socket_init.on("promo:valid",function(){console.log("GOOD PROMO!"),window.promoApproved=!0,b.keyup(function(){}),$("#promoBox").css("background","#A5F2AA"),setTimeout(function(){$("#promoBox").fadeOut(function(){setTimeout(function(){$("#fb-auth-new").fadeIn()},300)})},600)}),socket_init.on("promo:bad",function(){console.log("BAD PROMO!"),window.promoApproved=!1,$("#promoBox").css("background","#FAAFAF")}),socket_init.on("email:received",function(){$("#email-form-text").html("Email added to the list")}),socket_init.on("email:receivedWithFBID",function(){e(),g();var a=window.logged_in_fb_user.name;$("#email-form-text").html("<img src='http://graph.facebook.com/"+window.logged_in_fb_user.id+"/picture', id='fd-fb-photo' > <div id='email-message'> <span id='hi-message' >Hi "+window.logged_in_fb_user.name+"!</span> <span id='email-message-text'>"+"We'll send a promo code to</span> <span id='user-email'>"+window.logged_in_fb_user.email+"</span> <span id='email-message-text-2'> as soon as we can!</span> <span id='sig'> --Surfstream Team </sig></div>"),console.log(a),$("#email-form-text").css("font-size","14px"),$("#submit-email").css("height","110px"),$("#email-form").hide()}),socket_init.on("surfstream:gate",function(a){switch(a.details){case"approved":window.ss_fdLoop&&clearTimeout(window.ss_fdLoop),userLoggedOut||(window.SurfStreamApp=new SurfStreamModel({socket:socket_init,firstTime:a.firstTime}),a.firstTime?(window.SurfStreamApp.get("userModel").getFBUserDataForRegistration(),f()):SocketManagerModel.startApp(a.fbId));break;default:mpq.track("error",{mp_note:"Gate problem: response was "+a+", details were "+a.details})}});var d=$("#promoForm, #email-form");d.submit(function(){return!1}),FB.getLoginStatus(h)},$(function(){function a(){document.getElementById("frontdoor").style.display="none",document.getElementById("loadingScreen").style.display="none",document.getElementById("outer").style.display="block"}function b(){document.getElementById("loadingScreen").style.display="none",document.getElementById("outer").style.display="none",document.getElementById("frontdoor").style.display="inline-block"}function c(){$("#outer").hide(),$("#goodBye").show()}_.templateSettings={interpolate:/\{\{(.+?)\}\}/g},ZeroClipboard.setMoviePath("/swf/ZeroClipboard.swf"),socket_init=io.connect(),window.ChatMessageModel=Backbone.Model.extend({}),window.VideoPlayerModel=Backbone.Model.extend({}),window.RoomModel=Backbone.Model.extend({initialize:function(){this.get("userCollection").bind("reset",this.roomJoin,this)},updateDisplayedUsers:function(a){var b={},c=this.get("userCollection"),d=[];_.each(a,function(a){c.get(a.id)||c.add(a),b[a.id]=!0}),c.each(function(a){b[a.get("id")]||d.push(a)});for(var e in d)c.remove(d[e])},roomJoin:function(){var a=$("#avatarWrapper_VAL");a.css("margin-top",-120),a.data("animating",!1),SurfStreamApp.reelLoop&&(clearInterval(SurfStreamApp.reelLoop),SurfStreamApp.reelLoop=!1),$("#val_filmreel_right").stop(),$("#val_filmreel_left").stop(),a.animate({"margin-top":0},900,"bounceout")}}),window.SearchBarModel=Backbone.Model.extend({initialize:function(){this.startIndex=1,this.maxResults=10},executeSearch:function(a){this.get("searchResultsCollection").reset(),typeof mpq!="undefined"&&mpq.track("Search",{mp_note:"Searched for "+a}),this.set({searchTerm:a}),this.startIndex=1,this.divToRemove=null,$.ajax({url:"http://gdata.youtube.com/feeds/api/videos?max-results="+this.maxResults+"&start-index="+this.startIndex+"&v=2&format=5&alt=jsonc&q="+a,success:$.proxy(this.processResults,this)})},processResults:function(a){var b,c,d,e;b=a.data?a.data:jQuery.parseJSON(a).data;if(b.totalItems===0){new NoResultsView;return}c=b.items,d=this.get("searchResultsCollection"),e=[];for(var f=0;f<c.length;f++){var g=c[f],h={title:g.title,thumb:ss_idToImg(g.id),videoId:g.id,duration:g.duration,viewCount:g.viewCount?g.viewCount:0,author:g.uploader};e.push(h)}d.add(e),this.divToRemove&&$(this.divToRemove).remove()},executeSearchMoreResults:function(a){this.divToRemove=a;var b=this.get("searchTerm");this.startIndex+=10,$.ajax({url:"http://gdata.youtube.com/feeds/api/videos?max-results="+this.maxResults+"&start-index="+this.startIndex+"&v=2&format=5&alt=jsonc&q="+b,success:$.proxy(this.processResults,this)})}}),window.ShareModel=Backbone.Model.extend({initialize:function(){}}),window.UserModel=Backbone.Model.extend({defaults:{is_main_user:!1},initialize:function(){},getFBUserDataForRegistration:function(){this.get("is_main_user")&&FB.api("/me",this.setUserData)},setUserData:function(a){SurfStreamApp.get("userModel").set({profile:a}),SurfStreamApp.get("mainView").roomModal.hide(),SurfStreamApp.get("userModel").set({displayName:a.name}),new AvatarPickerView({isFirstVisit:!0}),typeof mpq!="undefined"&&mpq.track("Avatar Picker Registration",{}),window.avatar_picker_open_start_time=(new Date).getTime()},initializePlaylists:function(a,b){for(var c in a)a.hasOwnProperty(c)&&this.get("playlistCollection").addPlaylist(c,a[c].name,new PlaylistItemCollection(a[c].videos));$(".active-playlist-nameholder").removeClass("active-playlist-nameholder"),this.get("playlistCollection").setActivePlaylist(b),$(this.get("playlistCollection").idToPlaylistNameholder[b].el).addClass("active-playlist-nameholder"),this.importFacebook&&this.getUserPostedVideos()},sendUserFBFriends:function(a){var b=_.pluck(a.data,"id");SocketManagerModel.sendUserFBFriends({ssId:window.SurfStreamApp.get("userModel").get("ssId"),fbFriends:b})},getUserPostedVideos:function(){var a=new Date;SocketManagerModel.sendFBImportDate({date:a,ssId:this.get("ssId")}),FB.api("/me/feed?fields=from,link",{since:1133308800,limit:50},this.addUserPostedVideos)},addUserPostedVideos:function(a){console.log(a),a.paging&&a.paging.next&&FB.api("/me/feed?fields=from,link",{until:a.paging.next.substr(a.paging.next.indexOf("until")+6),limit:50},window.SurfStreamApp.get("userModel").addUserPostedVideos);for(var b in a.data)a.data[b].link&&a.data[b].link.indexOf("youtube")!=-1&&window.SurfStreamApp.get("userModel").addToFacebookPlaylist(a.data[b].link)},addToFacebookPlaylist:function(a){var b=a.substr(a.indexOf("v=")+2),c=b.indexOf("&")<11&&b.indexOf("&")!=-1?b.indexOf("&"):11,d=a.substr(a.indexOf("v=")+2,c);$.ajax({url:"http://gdata.youtube.com/feeds/api/videos?max-results=1&format=5&alt=json&q="+d,success:$.proxy(this.processYoutubeResult,this)})},processYoutubeResult:function(a){console.log("wow made it here"),console.log(a),console.log(a);var b=a.feed?a.feed:jQuery.parseJSON(a).feed,c=b.entry;if(!c)return;var d=c[0],e=d.id.$t.replace("http://gdata.youtube.com/feeds/api/videos/","");if(ss_modelWithAttribute(this.get("playlistCollection"),"videoId",e))return;var f={title:d.title.$t,thumb:d.media$group.media$thumbnail[0].url,videoId:e,duration:d.media$group.yt$duration.seconds,viewCount:d.yt$statistics.viewCount,author:d.author[0].name.$t},g=new PlaylistItemModel(f);g.set({playlistId:facebookPlaylistId}),this.get("playlistCollection").getPlaylistById(facebookPlaylistId).get("videos").add(g),SocketManagerModel.addVideoToPlaylist(facebookPlaylistId,g.get("videoId"),g.get("thumb"),g.get("title"),g.get("duration"),g.get("viewCount"),g.get("author"),!0);if(facebookPlaylistId==this.get("playlistCollection").get("activePlaylist").get("playlistId")){var h=new PlaylistCellViewTwo({playlistItemModel:g,playlistId:g.get("playlistId"),id:g.get("videoId")});h.initializeViewToTop(!1)}},logout:function(){FB.logout(),c(),typeof mpq!="undefined"&&mpq.track("Logout",{})}}),window.SurfStreamModel=Backbone.Model.extend({defaults:{sharing:new ShareModel},initialize:function(){this.vidsPlayed=0,this.fullscreen=!1,this.onSofa=!1,this.curDJ="__none__",this.sofaUsers=[],this.rotateRemoteSign=!0,this.chatMap={},$("#feedbackSpan").click(function(){feedback_widget.show()});var a,b;this.set({mainRouter:new RaRouter({})}),this.set({roomModel:new RoomModel({playerModel:new VideoPlayerModel,chatCollection:new ChatCollection,userCollection:new UserCollection,roomListCollection:new RoomlistCollection,channelHistoryCollection:new ChannelHistoryCollection,fbId:this.get("fbId")}),socketManagerModel:new SocketManagerModel({socket:this.get("socket"),app:this}),searchBarModel:new SearchBarModel({searchResultsCollection:new SearchResultsCollection})}),this.set({userModel:new UserModel({is_main_user:!0,playlistCollection:new PlaylistCollection,likesCollection:new LikesCollection,activePlaylist:null,socketManagerModel:this.get("socketManagerModel"),fbId:this.get("fbId")})}),this.set({mainView:new MainView({userModel:this.get("userModel")})}),b=this.get("mainView"),a=this.get("roomModel"),b.initializeTopBarView(),this.stickRoomModal=ss_getPath(window.location)=="/",b.initializeRoomListView(a.get("roomListCollection"),this),b.initializePlayerView(a.get("playerModel"),a.get("userCollection"),this.get("userModel"),b.roomModal),b.initializeSidebarView(this.get("searchBarModel"),this.get("userModel").get("playlistCollection"),a.get("channelHistoryCollection"),this.get("userModel").get("likesCollection"),a.get("chatCollection"),this.get("userModel")),b.initializeSounds()}}),window.RoomlistCellModel=Backbone.Model.extend({initialize:function(){this.set({friends:[]})}}),window.ChatCollection=Backbone.Collection.extend({model:ChatMessageModel,defaults:{clientId:0},initialize:function(){}}),window.ChannelHistoryModel=Backbone.Model.extend({}),window.ChannelHistoryCollection=Backbone.Collection.extend({model:ChannelHistoryModel}),window.LikesModel=Backbone.Model.extend({}),window.LikesCollection=Backbone.Collection.extend({model:LikesModel}),window.SearchResultModel=Backbone.Model.extend({}),window.SearchResultsCollection=Backbone.Collection.extend({model:SearchResultModel,initialize:function(){}}),window.RoomlistCollection=Backbone.Collection.extend({model:RoomlistCellModel,initialize:function(){this.comparator=function(a){return-a.get("friends").length*15+ -a.get("numUsers")}}}),window.UserCollection=Backbone.Collection.extend({model:UserModel,initialize:function(){}}),window.AvatarPickerView=Backbone.View.extend({el:"#avatar-picker-modal",avatarPickerTemplate:_.template($("#avatar-picker-template").html()),events:{"click #saveChanges":"saveAvatar","click #cancelPicker":"closePicker"},initialize:function(){$("#modalBG").show();if(this.options.justTutorial){$(this.el).html(this.make("img",{id:"tutorial",src:"/images/room/val-info.png"})),$(this.el).fadeIn(),$("#tutorial").fadeIn(),typeof mpq!="undefined"&&mpq.track("Tutorial Opened",{}),$("#modalBG").click({modal:this},function(a){if(a.data.modal.options.isFirstVisit)return;a.data.modal.remove(),typeof mpq!="undefined"&&mpq.track("Tutorial Closed",{timeSpent:Math.floor(((new Date).getTime()-window.avatar_picker_open_start_time)/1e3)+" seconds"}),$("#roomsList").after("<div id=avatar-picker-modal></div>"),$("#change-avatar").hide(),$("#modalBG").hide(),$("#logout").hide()});return}$("#modalBG").click({modal:this},function(a){if(a.data.modal.options.isFirstVisit)return;typeof mpq!="undefined"&&mpq.track("Avatar Picker Closed",{timeSpent:Math.floor(((new Date).getTime()-window.avatar_picker_open_start_time)/1e3)+" seconds"}),a.data.modal.remove(),$("#roomsList").after("<div id=avatar-picker-modal></div>"),$("#change-avatar").hide(),$("#edit-profile").hide(),$("#logout").hide(),$("#modalBG").hide()}),this.render(),$("#name-change-input").val(SurfStreamApp.get("userModel").get("displayName")),$(".picker-el").click({picker:this},this.handlePickerElClick),this.previewWrapper=$($(".picker-preview-avatar-wrapper")[0]),this.previewWrapper.css({"margin-left":52,"margin-top":60}),this.options.isFirstVisit&&(SurfStreamApp.currentAvatarSettings=[Math.ceil(Math.random()*5),Math.ceil(Math.random()*3),Math.ceil(Math.random()*2),Math.ceil(Math.random()*6)-1,Math.ceil(Math.random()*5),Math.ceil(Math.random()*5)-1],$("#cancelPicker").hide(),$("#saveChanges").css({"margin-left":27,width:139}),$("#saveChanges").html("Start Surfing")),this.setSelected("body",SurfStreamApp.currentAvatarSettings[0]),this.setSelected("eye",SurfStreamApp.currentAvatarSettings[1]),this.setSelected("eyesize",SurfStreamApp.currentAvatarSettings[2]),this.setSelected("glasses",SurfStreamApp.currentAvatarSettings[3]),this.setSelected("smile",SurfStreamApp.currentAvatarSettings[4]),this.setSelected("hat",SurfStreamApp.currentAvatarSettings[5]),$(this.el).show(),this.highlightCurrents(SurfStreamApp.currentAvatarSettings),this.idMapper={blue:1,green:2,purple:3,red:4,yellow:5,cute:1,cartoon:2,blueeyes:3,small:1,large:2,dark:1,thick:2,redshades:3,shiny:4,monocole:5,cucumber:1,openmouth:2,modest:3,vampire:4,openteeth:5,headphone:1,bow:2,brown:3,horns:4,none:0}},highlightCurrents:function(a){var b="4px solid orange",c;switch(parseInt(a[0])){case 1:c=$("#ap_body_blue").parent(),c.css({border:b});break;case 2:c=$("#ap_body_green").parent(),c.css({border:b});break;case 3:c=$("#ap_body_purple").parent(),c.css({border:b});break;case 4:c=$("#ap_body_red").parent(),c.css({border:b});break;case 5:c=$("#ap_body_yellow").parent(),c.css({border:b})}switch(parseInt(a[1])){case 1:c=$("#ap_eye_cute").parent().css({border:b});break;case 2:c=$("#ap_eye_cartoon").parent().css({border:b});break;case 3:c=$("#ap_eye_blueeyes").parent().css({border:b})}switch(parseInt(a[2])){case 1:c=$("#ap_eyesize_small").parent().css({border:b});break;case 2:c=$("#ap_eyesize_large").parent().css({border:b})}switch(parseInt(a[3])){case 0:c=$("#ap_glasses_none").parent().css({border:b});break;case 1:c=$("#ap_glasses_dark").parent().css({border:b});break;case 2:c=$("#ap_glasses_thick").parent().css({border:b});break;case 3:c=$("#ap_glasses_redshades").parent().css({border:b});break;case 4:c=$("#ap_glasses_shiny").parent().css({border:b});break;case 5:c=$("#ap_glasses_monocole").parent().css({border:b})}switch(parseInt(a[4])){case 1:c=$("#ap_smile_cucumber").parent().css({border:b});break;case 2:c=$("#ap_smile_openmouth").parent().css({border:b});break;case 3:c=$("#ap_smile_modest").parent().css({border:b});break;case 4:c=$("#ap_smile_vampire").parent().css({border:b});break;case 5:c=$("#ap_smile_openteeth").parent().css({border:b})}switch(parseInt(a[5])){case 1:$("#ap_hat_headphone").parent().css({border:b});break;case 2:$("#ap_hat_bow").parent().css({border:b});break;case 3:$("#ap_hat_brown").parent().css({border:b});break;case 4:$("#ap_hat_horns").parent().css({border:b})}},render:function(){$(this.el).html(this.avatarPickerTemplate())},saveAvatar:function(){if($("#name-change-input").val()==""){$("#name-change-input").css({"border-color":"red"}),$("#name-change-text").append('<span style="color: red"> !</span>');return}var a=[];a.push(this.bodyID),a.push(this.eyeID),a.push(this.eyesizeID),a.push(this.glassesID),a.push(this.smileID),a.push(this.hatID),SurfStreamApp.currentAvatarSettings=a,SurfStreamApp.get("userModel").set({displayName:$("#name-change-input").val()});if(this.options.isFirstVisit){var b=SurfStreamApp.get("userModel").get("profile");b.ss_name=SurfStreamApp.get("userModel").get("displayName"),b.avatarSettings=a,SocketManagerModel.initializeProfile(b),SurfStreamApp.waitForTutorialEnd=!0,$("#tutorial").fadeIn(),$("#tutorialStart").fadeIn(),this.showModal=window.SurfStreamApp.stickRoomModal,$("#tutorialStart").click({picker:this},function(a){a.data.picker.closePicker(),Backbone.history.start({pushState:!0,silent:a.data.picker.showModal}),a.data.picker.showModal&&SurfStreamApp.get("mainView").roomModal.show()}),typeof mpq!="undefined"&&mpq.track("Avatar Picker Registration",{timeSpent:Math.floor(((new Date).getTime()-window.avatar_picker_open_start_time)/1e3)+" seconds"})}else typeof mpq!="undefined"&&mpq.track("Avatar Picker Closed",{timeSpent:Math.floor(((new Date).getTime()-window.avatar_picker_open_start_time)/1e3)+" seconds"}),SocketManagerModel.updateAvatar(),this.closePicker()},closePicker:function(){this.remove(),$("#roomsList").after("<div id=avatar-picker-modal></div>"),$("#modalBG").hide(),$("#change-avatar").hide(),$("#edit-profile").hide(),$("#logout").hide()},handlePickerElClick:function(a){var b=a.currentTarget.firstChild.id,c=/ap_(.+)_(.+)/,d=c.exec(b);$("#picker-"+d[1]+" > .picker-el").css({border:"1px solid white"}),$(a.currentTarget).css({border:"4px solid orange"}),console.log("body part: "+d[1]),console.log("id: "+d[2]),a.data.picker.setSelected(d[1],a.data.picker.idMapper[d[2]])},setSelected:function(a,b){var c;switch(a){case"body":this.bodyID=b,$(".body-preview").remove(),this.previewWrapper.removeClass(),this.previewWrapper.addClass("avt_"+b),this.previewWrapper.prepend(this.buildBodyPart("body",b));break;case"eye":this.eyeID=b,$(".eye-preview-left").remove(),$(".eye-preview-right").remove(),this.buildEyes(this.eyeID,this.eyesizeID);break;case"eyesize":this.eyesizeID=b,$(".eye-preview-left").remove(),$(".eye-preview-right").remove(),this.buildEyes(this.eyeID,this.eyesizeID);break;case"glasses":$(".glasses-preview").remove(),b!=0&&this.previewWrapper.append(this.buildBodyPart("glasses",b)),this.glassesID=b;break;case"smile":$(".smile-preview").remove(),this.previewWrapper.append(this.buildBodyPart("smile",b)),this.smileID=b;break;case"hat":$(".hat-preview").remove(),b!=0&&this.previewWrapper.append(this.buildBodyPart("hat",b)),this.hatID=b;break;default:alert("fuuu")}},buildBodyPart:function(a,b,c){return this.make("img",{src:this.bodyPartToPath(a,b),style:"position: absolute;","class":this.bodyPartToClass(a,b)})},buildEyes:function(a,b){var c=this.bodyPartToPath("eye",a);this.previewWrapper.append(this.make("img",{src:c,style:"position: absolute;","class":this.getEyeClass(a,b,!0)})),this.previewWrapper.append(this.make("img",{src:c,style:"position: absolute;","class":this.getEyeClass(a,b,!1)}))},getEyeClass:function(a,b,c){var d="eye_"+(c?"left":"right")+"_";switch(parseInt(a)){case 1:d=d+"cute_";break;case 2:d=d+"cartoon_";break;case 3:d=d+"blue_"}switch(parseInt(b)){case 1:d=d+"medium";break;case 2:d=d+"large"}return d+" eye-preview-"+(c?"left":"right")},bodyPartToPath:function(a,b){var c="/images/room/monsters/";switch(a){case"body":switch(parseInt(b)){case 1:c=c+"blue.png";break;case 2:c=c+"green.png";break;case 3:c=c+"purple.png";break;case 4:c=c+"red.png";break;case 5:c=c+"yellow.png"}break;case"eye":c=c+"eyes/";switch(parseInt(b)){case 1:c=c+"cute-medium.png";break;case 2:c=c+"cartoon-medium.png";break;case 3:c=c+"blue-medium.png"}break;case"glasses":c=c+"accessories/";switch(parseInt(b)){case 1:c=c+"glasses-dark.png";break;case 2:c=c+"glasses-thick.png";break;case 3:c=c+"glasses-red.png";break;case 4:c=c+"glasses-shiny.png";break;case 5:c=c+"glasses-monocole.png"}break;case"smile":c=c+"smiles/";switch(parseInt(b)){case 1:c=c+"cucumberteeth.png";break;case 2:c=c+"openmouth.png";break;case 3:c=c+"modest.png";break;case 4:c=c+"vampireteeth.png";break;case 5:c=c+"openteeth.png"}break;case"hat":c=c+"accessories/";switch(parseInt(b)){case 1:c=c+"hat-headphones.png";break;case 2:c=c+"hat-bow.png";break;case 3:c=c+"hat-brown.png";break;case 4:c=c+"hat-horns.png"}break;default:alert("fuuu")}return c},bodyPartToClass:function(a,b){var c="-preview ";switch(a){case"body":return"body-preview";case"glasses":c="glasses"+c;switch(parseInt(b)){case 1:c=c+"glasses_dark";break;case 2:c=c+"glasses_thick";break;case 3:c=c+"glasses_red";break;case 4:c=c+"glasses_shiny";break;case 5:c=c+"glasses_monocole"}break;case"smile":c="smile"+c;switch(parseInt(b)){case 1:c=c+"smile_cucumber";break;case 2:c=c+"smile_openmouth";break;case 3:c=c+"smile_modest";break;case 4:c=c+"smile_vampire";break;case 5:c=c+"smile_openteeth"}break;case"hat":c="hat"+c;switch(parseInt(b)){case 1:c=c+"hat-headphones";break;case 2:c=c+"hat-bow";break;case 3:c=c+"hat-brown";break;case 4:c=c+"hat-horns"}break;default:alert("fuuu")}return c}}),window.DeleteConfirmationView=Backbone.View.extend({id:"playlist-delete-modal",deleteConfirmTemplate:_.template($("#playlist-delete-confirmation-template").html()),events:{"click .cancelDelete":"cancelDelete","click .deletePlaylist":"deletePlaylist"},initialize:function(){$("#modalBG").show(),$("#modalBG").click({modal:this.el},function(a){console.log("FUCK"),$(a.data.modal).hide()}),this.render(),$(this.el).show()},render:function(){$(this.el).html(this.deleteConfirmTemplate({playlist_title:this.options.playlistTitle})),document.body.appendChild(this.el)},cancelDelete:function(){this.remove(),$("#modalBG").hide()},deletePlaylist:function(){this.options.nameholderView.removeNameholder(),this.remove(),$("#modalBG").hide()}}),window.SideBarView=Backbone.View.extend({el:"#sidebar",sidebarTemplate:_.template($("#sidebar-template").html()),initialize:function(){this.render(),this.videoManagerView=new VideoManagerView({sideBarView:this,searchBarModel:this.options.searchBarModel,likesCollection:this.options.likesCollection,channelHistoryCollection:this.options.channelHistoryCollection,playlistCollection:this.options.playlistCollection}),this.chatView=new ChatView({chatCollection:this.options.chatCollection,userModel:this.options.userModel,expandSize:537,shrinkSize:154}),this.chatExpanded=!0,this.valVoteExpanded=!1,this.videoManagerExpanded=!1,this.sideBarHeight=633},render:function(){return $(this.el).html(this.sidebarTemplate()),this},showValVoteView:function(){this.chatExpanded&&this.shrinkChatView();if(this.valVoteExpanded)return;this.valVoteExpanded=!0,this.hideVideoManagerView(),this.valVoteView.valVoteBody.slideDown(300)},hideValVoteView:function(){if(!this.valVoteExpanded)return;this.valVoteView.valVoteBody.slideUp(300),this.valVoteExpanded=!1,this.videoManagerExpanded||this.expandChatView()},showVideoManagerView:function(){this.chatExpanded&&this.shrinkChatView();if(this.videoManagerExpanded)return;this.videoManagerExpanded=!0,this.hideValVoteView(),this.videoManagerView.videoManagerBody.slideDown(300)},hideVideoManagerView:function(){if(!this.videoManagerExpanded)return;this.videoManagerView.videoManagerBody.slideUp(300),this.videoManagerExpanded=!1,this.valVoteExpanded||this.expandChatView()},expandChatView:function(){this.chatView.expandChatView(),this.chatExpanded=!0},shrinkChatView:function(){this.chatView.shrinkChatView(),this.chatExpanded=!1},hidePlaylistView:function(){if(!this.playlistActive)return;$(".active-playlist-nameholder").removeClass("active-playlist-nameholder"),$("#playlist-view").hide(),this.playlistActive=!1},showPlaylistView:function(){if(this.playlistActive)return;$("#playlist-view").show(),this.browseVideosView.activeNonPlaylistNameholder.deactivateNameholder(),this.browseVideosView.searchView.hide(),this.playlistActive=!0}}),window.ValVoteView=Backbone.View.extend({el:"#valVoteContainer",valVoteTemplate:_.template($("#val-vote-template").html()),events:{"click #valVoteHeader":"toggleValVote"},initialize:function(){this.sideBarView=this.options.sideBarView,this.render(),this.valVoteHeader=$(this.el).find("#valVoteHeader"),this.valVoteBody=$(this.el).find("#valVoteBody"),this.valVoteBody.hide()},render:function(){$(this.el).html(this.valVoteTemplate())},toggleValVote:function(a){this.sideBarView.valVoteExpanded?this.sideBarView.hideValVoteView():this.sideBarView.showValVoteView()}}),window.VideoManagerView=Backbone.View.extend({el:"#videoManagerContainer",videoManagerTemplate:_.template($("#video-manager-template").html()),events:{"click #videoManagerHeader":"toggleVideoManager"},initialize:function(){this.sideBarView=this.options.sideBarView,this.options.playlistCollection.videoManagerView=this,this.render(),this.videoManagerHeader=$(this.el).find("#videoManagerHeader"),this.videoManagerBody=$(this.el).find("#videoManagerBody"),this.collapseBodyButton=$(this.el).find(".collapseBody"),this.videoManagerBody.hide(),this.browseVideosView=new BrowseVideosView({videoManagerView:this,searchBarModel:this.options.searchBarModel,likesCollection:this.options.likesCollection,channelHistoryCollection:this.options.channelHistoryCollection}),this.playlistCollectionView=new PlaylistCollectionView({playlistCollection:this.options.playlistCollection}),this.playlistExpanded=!0},render:function(){$(this.el).html(this.videoManagerTemplate())},toggleVideoManager:function(a){this.sideBarView.videoManagerExpanded?(this.sideBarView.hideVideoManagerView(),this.collapseBodyButton.animate({rotate:"0deg"},300,"linear")):(this.sideBarView.showVideoManagerView(),this.collapseBodyButton.animate({rotate:"90deg"},300,"linear"),this.calculatePlaylistHeight())},showBrowseVideosView:function(){if(!this.playlistExpanded)return;this.playlistExpanded=!1,this.hidePlaylistCollectionView()},hideBrowseVideosView:function(){this.browseVideosView.searchView.hide(),this.browseVideosView.deactivateNameholder()},showPlaylistCollectionView:function(){if(this.playlistExpanded)return;this.playlistExpanded=!0,$(this.playlistCollectionView.playlistView.el).slideDown(300),this.hideBrowseVideosView()},hidePlaylistCollectionView:function(){$(".active-playlist-nameholder").removeClass("active-playlist-nameholder"),$(this.playlistCollectionView.playlistView.el).slideUp(300)},calculatePlaylistHeight:function(){var a=$("#playlist-collection-display").outerHeight(!0),b=$("#myVideosContainer").outerHeight(!0);$("#playlist-display").css("height",b-a-7)}}),window.SearchView=Backbone.View.extend({searchViewTemplate:_.template($("#searchView-template").html()),viewMoreTemplate:_.template($("#view-more-cell-template").html()),el:"#browseVideosVideosContainer",initialize:function(){this.render(),this.previewPlayerView=new PreviewPlayerView;var a=$("#searchBar .inputBox");a.bind("submit",{searchView:this},this.searchVideos),this.suggestionHash={},
$("#youtubeInput").autocomplete({source:this.suggestionList,select:function(a,b){console.log(b.item.value)}}),$("#youtubeInput").bind("autocompleteselect",{searchView:this},function(a,b){$("#searchContainer").empty(),a.data.searchView.options.searchBarModel.executeSearch(b.item.value)}),a.bind("keyup",{searchView:this},this.getSuggestions),this.options.searchBarModel.get("searchResultsCollection").bind("add",this.updateResults,this);var b=$("#clearsearch");b.bind("click",function(){$(":input","#searchBar .inputBox").val(""),$("#youtubeInput").autocomplete("close")}),$(".searchCellContainer .videoInfo,.searchCellContainer .thumbContainer").live("mouseover mouseout",function(a){a.type=="mouseover"?a.currentTarget.className=="videoInfo"?$(a.currentTarget.parentNode.parentNode.children[1]).show():$(a.currentTarget.nextSibling).show():a.currentTarget.className=="videoInfo"?$(a.currentTarget.parentNode.parentNode.children[1]).hide():$(a.currentTarget.nextSibling).hide()})},render:function(){return $(this.el).html(this.searchViewTemplate()),this},hide:function(a){$("#searchBar").slideUp(300),$("#searchContainer").animate({height:0},300,function(){})},show:function(a){var b=$("#playlist-display").height(),c=$("#searchBar");a?(c.slideDown(300,function(){}),$("#searchContainer").animate({height:b-36},300,function(){})):(c.slideUp(300),$("#searchContainer").animate({height:b},300,function(){}))},searchVideos:function(a){a.preventDefault();var b=$($("input[name=search]")[0]).val();return $("#searchContainer").empty(),a.data.searchView.options.searchBarModel.executeSearch(b),!1},updateResults:function(a,b){new SearchCellView({video:a,toTop:!1}),a.collection.length%this.options.searchBarModel.maxResults==0&&new ViewMoreCellView({searchBarModel:this.options.searchBarModel})},getSuggestions:function(a){if(a.keyCode==13){$("#youtubeInput").autocomplete("option","disabled",!0),$("#youtubeInput").autocomplete("close");return}$("#youtubeInput").autocomplete("option","disabled",!1);var b=$("#searchBar .inputBox :input"),c=b.val();if(a.data.searchView.suggestionHash[c])$("#youtubeInput").autocomplete("option","source",a.data.searchView.suggestionHash[c]);else{var d=c.length,e="http://suggestqueries.google.com/complete/search?hl=en&ds=yt&client=youtube&hjson=t&jsonp=window.setSuggestions&q="+encodeURIComponent(c)+"&cp="+d;$.ajax({type:"GET",url:e,dataType:"script"})}},suggestions:function(){return this.suggestionList}}),window.SearchCellView=Backbone.View.extend({searchCellTemplate:_.template($("#searchCell-template").html()),className:"searchCellContainer nameholder-droppable",events:{"click .previewVideo":"previewVideo","click .addToQueue":"addToQueue"},initialize:function(){this.render(),$(this.el).attr("id",this.options.video.get("videoId")),this.options.toTop?$("#searchContainer").prepend(this.el):$("#searchContainer").append(this.el),$(this.el).draggable({helper:"clone",opacity:.6,cursorAt:{bottom:40,left:142},zIndex:6,alreadyRotated:!1,start:function(a,b){window.SurfStreamApp.get("userModel").get("playlistCollection").showDroppable()},drag:function(a,b){if($(a.target).draggable("option","alreadyRotated"))return;$(a.target).css("visibility","hidden");var c=$(b.item).attr("id");$(b.helper).find(".previewVideo").remove(),$(b.helper).addClass("shrunkenSearchCellContainer"),$(b.helper).css("margin-left",100).css("margin-top",-45),$(b.helper).css("height",40).css("width",142),$(b.helper).stop().animate({rotate:-70},500,function(){}),$(a.target).draggable("option","alreadyRotated",!0)},stop:function(a,b){$(a.target).draggable("option","alreadyRotated",!1),$(a.target).css("visibility","visible");var c=$("#searchContainer").offset();$(b.helper).css("height",80).css("width",285),$(b.helper).removeClass("shrunkenSearchCellContainer"),$(b.helper).offset({top:c.top,left:c.left}),$(b.helper).css("margin-top",0),window.SurfStreamApp.get("userModel").get("playlistCollection").hideDroppable()}}),this.$(".thumbContainer").click({cell:this.options},this.previewVideo),$(".addToQueue").tipsy({gravity:"w"}),this.buttonToQueue=$(this.el).find(".addToQueue"),SurfStreamApp.get("userModel").get("playlistCollection").getPlaylistById(queueId).hasVideo(this.options.video.get("videoId"))&&(this.buttonToQueue.css("background",'url("/images/room/checkbox.png") 50% 50% no-repeat'),this.buttonToQueue.attr("title","In your Queue"))},previewVideo:function(a){var b=a.data.cell.video.get("videoId");$(window.YTPlayerTwo).css({height:187}),$("#previewContainer").animate({top:273}),$("#searchContainer").animate({scrollTop:0+(this.offsetTop-211)}),window.YTPlayerTwo.loadVideoById(b)},addToQueue:function(a){var b=SurfStreamApp.get("userModel").get("playlistCollection");if(b.getPlaylistById(queueId).hasVideo(this.options.video.get("videoId"))){window.SurfStreamApp.get("mainView").theatreView.valChat("Sorry, but your queue already has that video.");return}this.buttonToQueue.css("background",'url("/images/room/checkbox.png") 50% 50% no-repeat'),this.buttonToQueue.attr("title","In your Queue");var c=$(this.el).clone();$("body").append(c),c.removeClass("searchCellContainer").addClass("shrunkenSearchCellContainer");var d=$(SurfStreamApp.get("userModel").get("playlistCollection").idToPlaylistNameholder[queueId].el).offset(),e=$(SurfStreamApp.get("userModel").get("playlistCollection").idToPlaylistNameholder[queueId].el).width(),f=$(SurfStreamApp.get("userModel").get("playlistCollection").idToPlaylistNameholder[queueId].el).height();c.offset({top:d.top+f/2-c.height()/2-54,left:d.left+e/2-30}),c.animate({rotate:-70},100,function(){var a=$(this).offset();$(this).animate({width:"1px",height:"5px",top:a.top+115,left:a.left+15},500,function(){$(this).remove()})});var g={thumb:this.options.video.get("thumb"),title:this.options.video.get("title"),videoId:this.options.video.get("videoId"),duration:this.options.video.get("duration"),viewCount:this.options.video.get("viewCount"),author:this.options.video.get("author")},h=new PlaylistItemModel(g);b.addVideoToPlaylist(queueId,h),typeof mpq!="undefined"&&mpq.track("Add to Queue",{mp_note:"From search cell view from the button",source:"Search - Button"})},render:function(a){return $(this.el).html(this.searchCellTemplate({thumb:this.options.video.get("thumb"),title:this.options.video.get("title"),vid_id:this.options.video.get("videoId"),duration:ss_formatSeconds(this.options.video.get("duration")),realDuration:this.options.video.get("duration"),viewCount:this.options.video.get("viewCount")>0?ss_formatViews(this.options.video.get("viewCount")):"",realViewCount:this.options.video.get("viewCount"),author:this.options.video.get("author")})),$(this.el).find(".thumbContainer").attr("src",this.options.video.get("thumb")),this}}),window.VideoPlayerView=Backbone.View.extend({el:"#funroom",roomTemplate:_.template($("#room-template").html()),initialize:function(){$(this.el).html(this.roomTemplate());if(!window.playerLoaded){var a={wmode:"opaque",allowScriptAccess:"always",modestbranding:1,iv_load_policy:3},b={id:"YouTubePlayer"};swfobject.embedSWF("http://www.youtube.com/apiplayer?version=3&enablejsapi=1&playerapiid=YouTubePlayer","video-container","640","390","8",null,null,a,b),setInterval(updateTime,300)}}}),window.ViewMoreCellView=Backbone.View.extend({viewMoreCellTemplate:_.template($("#view-more-cell-template").html()),id:"viewMoreCellContainer",events:{click:"moreResults"},initialize:function(){$("#searchContainer").append(this.render())},render:function(){return $(this.el).html(this.viewMoreCellTemplate()),this.el},moreResults:function(a){this.options.searchBarModel.executeSearchMoreResults("#viewMoreCellContainer")}}),window.NoResultsView=Backbone.View.extend({noResultsTemplate:_.template($("#no-results-template").html()),id:"noResultsContainer",initialize:function(){$("#searchContainer").append(this.render())},render:function(){return $(this.el).html(this.noResultsTemplate()),this.el}}),window.PreviewPlayerView=Backbone.View.extend({el:"#previewContainer",previewTemplate:_.template($("#search-preview-template").html()),events:{"click .hidePlayer":"hidePreviewPlayer"},initialize:function(){$(this.el).html(this.previewTemplate());var a={allowScriptAccess:"always",wmode:"opaque",allowFullScreen:"false",autohide:1,iv_load_policy:3},b={id:"YouTubePlayerTwo"};swfobject.embedSWF("http://www.youtube.com/v/9jIhNOrVG58?version=3&enablejsapi=1&playerapiid=YouTubePlayerTwo","preview-player","300","183","8",null,null,a,b)},hidePreviewPlayer:function(){window.playerTwoLoaded=!1,typeof window.YTPlayerTwo.stopVideo!="undefined"&&window.YTPlayerTwo.stopVideo(),$("#previewContainer").animate({top:462},500)}}),window.PlaylistItemModel=Backbone.Model.extend({}),window.PlaylistItemCollection=Backbone.Collection.extend({model:PlaylistItemModel}),window.PlaylistModel=Backbone.Model.extend({initialize:function(){console.log("herezzzzzzzzzzzzzz")},addToPlaylist:function(a){this.get("videos").add(a,{at:0});var b=this.get("videos").length;$(SurfStreamApp.get("userModel").get("playlistCollection").idToPlaylistNameholder[this.get("playlistId")].el).find(".playlist-nameholder-count").html("&nbsp;"+b+"&nbsp;")},removeFromPlaylist:function(a){var b=ss_modelWithAttribute(this.get("videos"),"videoId",a),c=new PlaylistItemModel(b.attributes);this.get("videos").remove(b);var d=this.get("videos").length;$(SurfStreamApp.get("userModel").get("playlistCollection").idToPlaylistNameholder[this.get("playlistId")].el).find(".playlist-nameholder-count").html("&nbsp;"+d+"&nbsp;"),window.SurfStreamApp.get("mainView").sideBarView.videoManagerView.playlistCollectionView.playlistView.setNotificationText(),SocketManagerModel.deleteFromPlaylist(this.get("playlistId"),a)},moveToIndexInPlaylist:function(){},hasVideo:function(a){return ss_modelWithAttribute(this.get("videos"),"videoId",a)?!0:!1}}),window.PlaylistCollection=Backbone.Model.extend({initialize:function(){this.idToPlaylist={},this.idToPlaylistNameholder={},this.playlistCollectionView=null},setActivePlaylist:function(a){var b=window.SurfStreamApp.get("userModel").get("playlistCollection"),c=b.get("activePlaylist");c&&$(b.idToPlaylistNameholder[c.get("playlistId")].el).removeClass("selected-playlist-nameholder").removeClass("active-playlist-nameholder"),this.videoManagerView.showPlaylistCollectionView(),SocketManagerModel.choosePlaylist(a),b.set({activePlaylist:b.getPlaylistById(a)}),window.SurfStreamApp.get("mainView").sideBarView.videoManagerView.playlistCollectionView.playlistView.setPlaylist(b.get("activePlaylist")),window.SurfStreamApp.get("mainView").sideBarView.videoManagerView.playlistCollectionView.playlistView.resetPlaylist(),playlistNameholderView=b.idToPlaylistNameholder[a],$(playlistNameholderView.el).removeClass("unselected-playlist-nameholder").addClass("selected-playlist-nameholder"),$("#playlist-dropdown").val(a)},deletePlaylist:function(a){if(a==this.get("activePlaylist").get("playlistId")){var b=this.randomPlaylistId(a);if(!b)return;this.setActivePlaylist(b)}delete this.idToPlaylist[a],delete this.idToPlaylistNameholder[a],SocketManagerModel.deletePlaylist(a)},getPlaylistById:function(a){return this.idToPlaylist[a]},addPlaylist:function(a,b,c){if(!b||b==""||this.hasPlaylistName(b))return;var d=new PlaylistModel;d.set({playlistId:a,name:b,videos:c}),this.idToPlaylist[a]=d;var e=new PlaylistNameholderView({playlist_nameholder_value:a,playlist_nameholder_name:b,playlistCollection:this,playlist_count:c.length});this.idToPlaylistNameholder[a]=e,console.log(d),e.setActivePlaylist()},removePlaylist:function(){},length:function(){return Object.size(this.idToPlaylist)},hasPlaylistName:function(a){for(var b in this.idToPlaylist)if(this.idToPlaylist.hasOwnProperty(b)&&this.idToPlaylist[b].get("name")==a)return!0;return!1},randomPlaylistId:function(a){for(var b in this.idToPlaylist)if(this.idToPlaylist.hasOwnProperty(b)&&b!=a)return b;return null},newPlaylistId:function(){var a=0;for(var b in this.idToPlaylist)this.idToPlaylist.hasOwnProperty(b)&&parseInt(b)>a&&(a=parseInt(b));return a+1},addVideoToPlaylist:function(a,b){b.set({playlistId:a}),this.getPlaylistById(a).addToPlaylist(b),SocketManagerModel.addVideoToPlaylist(a,b.get("videoId"),b.get("thumb"),b.get("title"),b.get("duration"),b.get("viewCount"),b.get("author"),!1),a==this.get("activePlaylist").get("playlistId")&&(window.SurfStreamApp.get("mainView").sideBarView.videoManagerView.playlistCollectionView.playlistView.addVideo(b,a),window.SurfStreamApp.get("mainView").sideBarView.videoManagerView.playlistCollectionView.playlistView.setNotificationText())},showDroppable:function(){for(var a in this.idToPlaylistNameholder)this.idToPlaylistNameholder.hasOwnProperty(a)&&a!=this.get("activePlaylist").get("playlistId")&&$(this.idToPlaylistNameholder[a].el).addClass("droppable-playlist-nameholder");$("#playlist-collection-input").hide()},hideDroppable:function(){for(var a in this.idToPlaylistNameholder)this.idToPlaylistNameholder.hasOwnProperty(a)&&a!=this.get("activePlaylist").get("playlistId")&&$(this.idToPlaylistNameholder[a].el).removeClass("droppable-playlist-nameholder");$("#browseVideosButtons").css("visibility","visible"),$("#playlist-collection-input").show()}}),window.PlaylistCollectionView=Backbone.View.extend({el:"#myVideosContainer",playlistCollectionTemplate:_.template($("#playlist-collection-template").html()),initialize:function(){this.render(),this.playlistView=new PlaylistView,$("#playlist-collection-input").bind("keyup",{playlistCollectionView:this},this.addPlaylist)},addPlaylist:function(a){if(a.keyCode!=13)return;var b=$("#playlist-collection-input").val();if(a.data.playlistCollectionView.options.playlistCollection.hasPlaylistName(b))return;if(b.length==0)return;var c=a.data.playlistCollectionView.options.playlistCollection.newPlaylistId();SocketManagerModel.addPlaylist(c,b),a.data.playlistCollectionView.options.playlistCollection.addPlaylist(c,b,new PlaylistItemCollection),$("#playlist-collection-input").val("")},render:function(){return $(this.el).html(this.playlistCollectionTemplate()),this}}),window.BrowseVideosView=Backbone.View.extend({el:"#browseVideosContainer",browseVideosTemplate:_.template($("#browse-videos-template").html()),events:{"click #ytnh":"showSearch","click #chnh":"showChannelHistory","click #lvnh":"showLikes"},initialize:function(){this.videoManagerView=this.options.videoManagerView,this.options.channelHistoryCollection.bind("add",this.addChannelHistoryView,this),this.options.likesCollection.bind("add",this.addLikesView,this),this.render(),this.searchActive=!1,this.channelHistoryActive=!1,this.likesActive=!1,this.searchView=new SearchView({searchBarModel:this.options.searchBarModel,playlistCollection:this.options.playlistCollection}),this.activeNonPlaylistNameholder=this.likesNameholderView},showSearch:function(){this.activeNonPlaylistNameholder&&this.deactivateNameholder(),this.searchActive=!0,this.channelHistoryActive=!1,this.likesActive=!1,this.searchView.show(!0),this.videoManagerView.showBrowseVideosView(),this.activeNonPlaylistNameholder=$(this.el).find("#ytnh"),this.activeNonPlaylistNameholder.addClass("selected-non-playlist-nameholder"),this.activeNonPlaylistNameholder.addClass("active-playlist-nameholder"),this.resetSearchResults()},showChannelHistory:function(){this.activeNonPlaylistNameholder&&this.deactivateNameholder(),this.searchActive=!1,this.channelHistoryActive=!0,this.likesActive=!1,this.searchView.show(!1),this.videoManagerView.showBrowseVideosView(),this.activeNonPlaylistNameholder=$(this.el).find("#chnh"),this.activeNonPlaylistNameholder.addClass("selected-non-playlist-nameholder"),this.activeNonPlaylistNameholder.addClass("active-playlist-nameholder"),this.resetChannelHistory()},showLikes:function(){this.activeNonPlaylistNameholder&&this.deactivateNameholder(),this.searchActive=!1,this.channelHistoryActive=!1,this.likesActive=!0,this.searchView.show(!1),this.videoManagerView.showBrowseVideosView(),this.activeNonPlaylistNameholder=$(this.el).find("#lvnh"),this.activeNonPlaylistNameholder.addClass("selected-non-playlist-nameholder"),this.activeNonPlaylistNameholder.addClass("active-playlist-nameholder"),this.resetLikes()},resetSearchResults:function(){$("#searchContainer").empty(),this.options.searchBarModel.get("searchResultsCollection").each(function(a){new SearchCellView({video:a,toTop:!1})})},resetChannelHistory:function(){$("#searchContainer").empty(),this.options.channelHistoryCollection.each(function(a){var b={title:a.get("title"),thumb:ss_idToImg(a.get("videoId")),videoId:a.get("videoId"),duration:a.get("duration"),viewCount:a.get("viewCount")?a.get("viewCount"):0,author:a.get("author")},c=new SearchResultModel(b);new SearchCellView({video:c,toTop:!1})})},resetLikes:function(){$("#searchContainer").empty(),this.options.likesCollection.each(function(a){var b={title:a.get("title"),thumb:ss_idToImg(a.get("videoId")),videoId:a.get("videoId"),duration:a.get("duration"),viewCount:a.get("viewCount")?a.get("viewCount"):0,author:a.get("author")},c=new SearchResultModel(b);new SearchCellView({video:c,toTop:!1})})},addChannelHistoryView:function(a){if(this.channelHistoryActive){var b={title:a.get("title"),thumb:ss_idToImg(a.get("videoId")),videoId:a.get("videoId"),duration:a.get("duration"),viewCount:a.get("viewCount")?a.get("viewCount"):0,author:a.get("author")},c=new SearchResultModel(b);new SearchCellView({video:c,toTop:!0})}},addLikesView:function(a){if(this.likesActive){var b={title:a.get("title"),thumb:ss_idToImg(a.get("videoId")),videoId:a.get("videoId"),duration:a.get("duration"),viewCount:a.get("viewCount")?a.get("viewCount"):0,author:a.get("author")},c=new SearchResultModel(b);new SearchCellView({video:c,toTop:!0})}},deactivateNameholder:function(){this.activeNonPlaylistNameholder.removeClass("selected-non-playlist-nameholder"),this.activeNonPlaylistNameholder.removeClass("active-playlist-nameholder")},render:function(){$(this.el).html(this.browseVideosTemplate())}}),window.PlaylistNameholderView=Backbone.View.extend({className:"playlist-nameholder",tagName:"li",playlistNameholderTemplate:_.template($("#playlist-nameholder-template").html()),events:{"click .delete-nameholder":"presentDialog",click:"setActivePlaylist"},initialize:function(){this.render(),$(this.el).droppable({accept:".nameholder-droppable",hoverClass:"playlist-hover-highlight",drop:function(a,b){var c=$(b.draggable).attr("id"),d=window.SurfStreamApp.get("userModel").get("playlistCollection"),e=$(this).val(),f=d.getPlaylistById(e);if(f.hasVideo(c)){window.SurfStreamApp.get("mainView").theatreView.valChat("Sorry, but that playlist already has that video.");return}$(this).addClass("dropped-playlist-nameholder");var g=$(b.helper).clone();$("body").append(g);var h=$(this).offset(),i=$(this).width();g.offset({top:h.top-125,left:h.left+i/2-10});var j=g.offset(),k=$(b.draggable).attr("class");if(k.indexOf("searchCellContainer")==-1){var l=d.get("activePlaylist"),m=ss_modelWithAttribute(l.get("videos"),"videoId",c),n=new PlaylistItemModel(m.attributes);d.addVideoToPlaylist(e,n),g.animate({width:"1px",height:"5px",top:j.top+175,left:j.left-90},500,function(){$(this).remove()}),e!=queueId?(b.draggable.remove(),l.removeFromPlaylist(c),typeof mpq!="undefined"&&mpq.track("Add to Playlist",{mp_note:"From another playlist from drag n drop",source:"Playlist - Drag and Drop"})):typeof mpq!="undefined"&&mpq.track("Add to Queue",{mp_note:"From another playlist from drag n drop",source:"Playlist - Drag and Drop"})}else{var o={title:$(b.draggable).find(".title").text(),thumb:ss_idToImg(c),duration:$(b.draggable).find(".realDuration").text(),videoId:c,viewCount:$(b.draggable).find(".realViewCount").text()},m=new PlaylistItemModel(o);d.addVideoToPlaylist(e,m),g.animate({width:"1px",height:"5px",top:j.top+180,left:j.left-87},500,function(){$(this).remove()}),b.draggable.remove(),e!=queueId?typeof mpq!="undefined"&&mpq.track("Add to Playlist",{mp_note:"From search result from drag n drop",source:"Search - Drag and Drop"}):typeof mpq!="undefined"&&mpq.track("Add to Queue",{mp_note:"From search result from drag n drop",source:"Search - Drag and Drop"})}$(this).animate({background:"white"},500,function(){$(this).removeClass("dropped-playlist-nameholder")})}}),(this.options.playlist_nameholder_value==facebookPlaylistId||this.options.playlist_nameholder_value==queueId)&&$(this.el).find(".delete-nameholder").remove(),this.options.playlistCollection.videoManagerView.calculatePlaylistHeight()},render:function(){$(this.el).prepend(this.playlistNameholderTemplate({playlist_name:this.options.playlist_nameholder_name,playlist_count:"&nbsp;"+this.options.playlist_count+"&nbsp;"})),$(this.el).val(this.options.playlist_nameholder_value),this.options.playlist_nameholder_value==queueId&&$(this.el).addClass("queuePlaylist").removeClass("playlist-nameholder");var a=$("#playlist-collection-display").children().length;return $(this.el).insertBefore($("#playlist-collection-display").children()[a-1]),this},printSomething:function(){console.log("works")},setActivePlaylist:function(a){if(a&&a.currentTarget.className=="delete-nameholder")return;this.options.playlistCollection.setActivePlaylist(this.options.playlist_nameholder_value),$(this.el).addClass("active-playlist-nameholder")},presentDialog:function(){new DeleteConfirmationView({playlistTitle:this.options.playlist_nameholder_name,nameholderView:this})},removeNameholder:function(){$(this.el).remove(),this.options.playlistCollection.videoManagerView.calculatePlaylistHeight(),this.options.playlistCollection.deletePlaylist(this.options.playlist_nameholder_value)},highlightView:function(){}}),window.PlaylistView=Backbone.View.extend({el:"#playlist-display",playlistTemplate:_.template($("#playlist-template").html()),playlistNotificationTemplate:_.template($("#playlist-notification-template").html()),initialize:function(){this.render(),$("#video-list-container").sortable({update:function(a,b){var c=$("#playlist-collection-display").offset().top+$("#playlist-collection-display").outerHeight()-b.item.height()*3/4,d=b.position.top;d<c&&$("#video-list-container").sortable("cancel");var e,f=$(b.item).attr("id"),g,h=$(this).sortable("toArray");for(e=0;e<h.length;e++)f==h[e]&&(g=e);var i=window.SurfStreamApp.get("userModel").get("playlistCollection").get("activePlaylist"),j=ss_modelWithAttribute(i.get("videos"),"videoId",f);if(j==null){b.item.remove();return}var k=new PlaylistItemModel(j.attributes);i.get("videos").remove(j,{silent:!0}),i.get("videos").add(k,{at:g,silent:!0}),window.SurfStreamApp.get("mainView").sideBarView.videoManagerView.playlistCollectionView.playlistView.setNotificationText(),SocketManagerModel.toIndexInPlaylist(i.get("playlistId"),f,g)},cursorAt:{bottom:30,left:142},axis:"y",helper:"clone",forceHelperSize:!0,alreadyShrunk:!1,opacity:.6,start:function(a,b){window.SurfStreamApp.get("userModel").get("playlistCollection").showDroppable()},sort:function(a,b){var c=$("#playlist-collection-display").offset().top+$("#playlist-collection-display").outerHeight()-b.item.height()/2,d=b.position.top;if(d<c&&!$("#video-list-container").sortable("option","alreadyShrunk")){var e=$(b.item).attr("id");$("#video-list-container").sortable("option","axis",!1),$(b.helper).addClass("shrunken-playlist-cell"),$(b.helper).css("margin-left",100).css("margin-top",-45),$(b.helper).css("height",30).css("width",142),$(b.helper).stop().animate({rotate:-70},500,function(){}),$("#video-list-container").sortable("option","alreadyShrunk",!0)}else d>c&&$("#video-list-container").sortable("option","alreadyShrunk")&&($("#video-list-container").sortable("option","appendTo","parent"),$(b.helper).stop().animate({rotate:0},500,function(){var a=$("#video-list-container").offset();$(b.helper).css("height",60).css("width",285).css("margin-top",0),$(b.helper).removeClass("shrunken-playlist-cell"),$(b.helper).offset({top:a.top,left:a.left}),$("#video-list-container").sortable("option","axis","y"),$("#video-list-container").sortable("option","alreadyShrunk",!1)}),$("#video-list-container").sortable("option","alreadyShrunk",!1))},stop:function(a,b){var c=$("#video-list-container").offset();$(b.helper).css("height",60).css("width",285),$(b.helper).removeClass("shrunken-playlist-cell"),$(b.helper).offset({top:c.top,left:c.left}),$(b.helper).css("margin-top",0),$("#video-list-container").sortable("option","axis","y"),$("#video-list-container").sortable("option","alreadyShrunk",!1),window.SurfStreamApp.get("userModel").get("playlistCollection").hideDroppable()}}),$("#video-list-container").disableSelection()},render:function(){return $(this.el).html(this.playlistTemplate()),$(this.el).prepend(this.playlistNotificationTemplate()),this},addVideo:function(a,b){var c;b==0?c=new PlaylistCellView({playlistItemModel:a,playlistId:b,id:a.get("videoId")}):c=new PlaylistCellViewTwo({playlistItemModel:a,playlistId:b,id:a.get("videoId")}),c.initializeViewToTop(!0)},resetPlaylist:function(){$("#video-list-container.videoListContainer").empty();for(var a=this.playlist.get("videos").length-1;a>=0;a--)this.addVideo(this.playlist.get("videos").at(a),this.playlist.get("playlistId"))},setPlaylist:function(a){this.playlist=a,this.setNotificationText()},setNotificationText:function(a){SurfStreamApp.get("userModel").get("playlistCollection").getPlaylistById(queueId).get("videos").length==0?$("#playlist-notification-text").text("Up next: Your queue is currently empty"):$("#playlist-notification-text").text("Up next: "+SurfStreamApp.get("userModel").get("playlistCollection").getPlaylistById(queueId).get("videos").at(0).get("title"))}}),window.PlaylistCellView=Backbone.View.extend({playlistCellTemplate:_.template($("#playlist-cell-template").html()),className:"videoListCellContainer nameholder-droppable",initializeViewToTop:function(a){var b,c,d;this.render(),a?$("#video-list-container").prepend(this.el):$("#video-list-container").append(this.el),d=this.options.playlistItemModel.get("videoId"),b=$("#remove_video_"+d),b.bind("click",{videoModel:this.options.playlistItemModel,playlistCollection:this.options.playlistItemModel.collection},this.removeFromPlaylist),c=$("#send_to_top_"+d),c.bind("click",{videoModel:this.options.playlistItemModel,playlistCollection:this.options.playlistItemModel.collection,context:this},this.toTheTop),this.options.playlistItemModel.bind("remove",this.removeFromList,this)},initializeViewToTopAndGrow:function(){var a,b,c;this.render(),$(this.el).css("display","none"),$("#video-list-container").prepend(this.el),$("#video-list-container").find(".videoListCellContainer").slideDown(500),c=this.options.playlistItemModel.get("videoId"),a=$("#remove_video_"+c),a.bind("click",{videoModel:this.options.playlistItemModel,playlistCollection:this.options.playlistItemModel.collection},this.removeFromPlaylist),b=$("#send_to_top_"+c),b.bind("click",{videoModel:this.options.playlistItemModel,playlistCollection:this.options.playlistItemModel.collection,context:this},this.toTheTop),this.options.playlistItemModel.bind("remove",this.removeFromList,this)},removeFromPlaylist:function(a){$(this).parent().parent().parent().slideUp(500,function(){$(this).remove()});var b=window.SurfStreamApp.get("userModel").get("playlistCollection").idToPlaylist[a.data.videoModel.get("playlistId")];b.removeFromPlaylist(a.data.videoModel.get("videoId"))},toTheTop:function(a){var b=new PlaylistItemModel(a.data.videoModel.attributes),c=a.data.playlistCollection;if(c.at(0).get("videoId")==a.data.videoModel.get("videoId"))return;$(this).parent().parent().parent().css("visibility","hidden"),$(this).parent().parent().parent().slideUp(500,function(){$(this).remove()});var d=ss_modelWithAttribute(c,"videoId",a.data.videoModel.get("videoId"));c.remove(d),c.add(b,{at:0,silent:!0}),SocketManagerModel.toTopOfPlaylist(a.data.videoModel.get("playlistId"),a.data.videoModel.get("videoId"));var e=new PlaylistCellView({playlistItemModel:b,playlistId:a.data.videoModel.get("playlistId"),id:a.data.videoModel.get("videoId")});e.initializeViewToTopAndGrow(),window.SurfStreamApp.get("mainView").sideBarView.videoManagerView.playlistCollectionView.playlistView.setNotificationText()},render:function(){return $(this.el).html(this.playlistCellTemplate({title:this.options.playlistItemModel.get("title"),vid_id:this.options.playlistItemModel.get("videoId"),duration:ss_formatSeconds(this.options.playlistItemModel.get("duration"))})),this.$(".thumbContainer").attr("src",this.options.playlistItemModel.get("thumb")),this},removeFromList:function(a,b){$("#vid_"+a.attributes.videoId).remove()}}),window.PlaylistCellViewTwo=Backbone.View.extend({playlistCellTemplate:_.template($("#playlist-cell-template-two").html()),className:"videoListCellContainer nameholder-droppable",initializeViewToTop:function(a){var b,c,d;this.render(),a?$("#video-list-container").prepend(this.el):$("#video-list-container").append(this.el),d=this.options.playlistItemModel.get("videoId"),b=$("#remove_video_"+d),b.bind("click",{videoModel:this.options.playlistItemModel,playlistCollection:this.options.playlistItemModel.collection},this.removeFromPlaylist),this.buttonToQueue=$("#add_to_queue_"+d);var e=SurfStreamApp.get("userModel").get("playlistCollection");e.getPlaylistById(queueId).hasVideo(d)&&(this.buttonToQueue.css("background",'url("/images/room/checkbox.png") 50% 50% no-repeat'),this.buttonToQueue.attr("title","In your Queue")),this.buttonToQueue.bind("click",{videoModel:this.options.playlistItemModel,playlistCell:this},this.addToQueue),this.options.playlistItemModel.bind("remove",this.removeFromList,this),this.$(".addToQueue, .remove").tipsy({gravity:"w"})},removeFromPlaylist:function(a){$(this).parent().parent().parent().slideUp(500,function(){$(this).remove()});var b=window.SurfStreamApp.get("userModel").get("playlistCollection").idToPlaylist[a.data.videoModel.get("playlistId")];b.removeFromPlaylist(a.data.videoModel.get("videoId"))},addToQueue:function(a){var b=SurfStreamApp.get("userModel").get("playlistCollection");if(b.getPlaylistById(queueId).hasVideo(a.data.videoModel.get("videoId"))){window.SurfStreamApp.get("mainView").theatreView.valChat("Your queue already has that video.");return}a.data.playlistCell.buttonToQueue.css("background",'url("/images/room/checkbox.png") 50% 50% no-repeat'),a.data.playlistCell.buttonToQueue.attr("title","In your Queue");var c=$(a.data.playlistCell.el).clone();$("body").append(c),c.removeClass("videoListCellContainer").addClass("shrunken-playlist-cell");var d=$(SurfStreamApp.get("userModel").get("playlistCollection").idToPlaylistNameholder[queueId].el).offset(),e=$(SurfStreamApp.get("userModel").get("playlistCollection").idToPlaylistNameholder[queueId].el).width(),f=$(SurfStreamApp.get("userModel").get("playlistCollection").idToPlaylistNameholder[queueId].el).height();c.offset({top:d.top+f/2-c.height()/2-58,left:d.left+e/2-37}),c.animate({rotate:-70},100,function(){var a=$(this).offset();$(this).animate({width:"1px",height:"5px",top:a.top+125,left:a.left+15},500,function(){$(this).remove()})});var g=new PlaylistItemModel(a.data.videoModel.attributes);b.addVideoToPlaylist(queueId,g),window.SurfStreamApp.get("mainView").sideBarView.videoManagerView.playlistCollectionView.playlistView.setNotificationText(),typeof mpq!="undefined"&&mpq.track("Add to Queue",{mp_note:"From another playlist through the button",source:"Playlist - Button"})},render:function(){return $(this.el).html(this.playlistCellTemplate({title:this.options.playlistItemModel.get("title"),vid_id:this.options.playlistItemModel.get("videoId"),duration:ss_formatSeconds(this.options.playlistItemModel.get("duration"))})),this.$(".thumbContainer").attr("src",this.options.playlistItemModel.get("thumb")),this},removeFromList:function(a,b){$("#vid_"+a.attributes.videoId).remove()}}),window.ImportFBVideosCell=Backbone.View.extend({id:"import-fb-videos-cell",importFBVideoTemplate:_.template($("#import-fb-videos-template").html()),events:{click:"importFBVideos"},initialize:function(){this.render()},render:function(){$(this.el).html(this.importFBVideoTemplate({text:"Import videos from your Facebook Wall"})),$("#video-list-container").prepend(this.el)},importFBVideos:function(a){$(this.el).remove(),window.SurfStreamApp.get("userModel").showFBButton=!1,window.SurfStreamApp.get("userModel").getUserPostedVideos()}}),window.ChatView=Backbone.View.extend({el:"#chatContainer",chatTemplate:_.template($("#chat-template").html()),initialize:function(){this.expandSize=this.options.expandSize,this.shrinkSize=this.options.shrinkSize,this.render(),this.messages=$(this.el).find("#messages"),this.expandChatView(),$(this.el).find(".soundToggler").live("click",{sound:this},this.toggleSound),this.options.chatCollection.bind("add",this.makeNewChatMsg,this),this.options.chatCollection.bind("reset",this.clearChat),this.chatContainer=new AutoScroll({bottomThreshold
:215,scrollContainerId:"messages"}),console.log(this.chatContainer)},render:function(){return $(this.el).html(this.chatTemplate()),this},events:{"submit .inputBox":"sendMessage"},sendMessage:function(a){var b=this.$("input[name=message]").val();return b==""?!1:(this.$("input[name=message]").val(""),SocketManagerModel.sendMsg({name:this.options.userModel.get("displayName"),text:b,id:this.options.userModel.get("ssId")}),!1)},makeNewChatMsg:function(a){new ChatCellView({username:a.get("username"),msg:a.get("msg")}),this.chatContainer.activeScroll()},toggleSound:function(a){window.SurfStreamApp.get("mainView").soundOn?($(a.data.sound.el).find(".soundToggler").text("Sound Off"),window.SurfStreamApp.get("mainView").soundOn=!1):($(a.data.sound.el).find(".soundToggler").text("Sound On"),window.SurfStreamApp.get("mainView").soundOn=!0)},clearChat:function(){$("#messages").empty()},expandChatView:function(){this.messages.animate({height:this.expandSize+"px"},300)},shrinkChatView:function(){this.messages.animate({height:this.shrinkSize+"px"},300)}}),window.RoomListView=Backbone.View.extend({el:"#roomsList",roomListTemplate:_.template($("#roomlist-template").html()),initialize:function(){var a;this.options.roomlistCollection.bind("reset",this.addRooms,this),this.options.app.stickRoomModal&&this.render()},hide:function(){$("#room-modal").hide(),$("#modalBG").hide()},hideByClick:function(a){if(typeof SurfStreamApp.inRoom=="undefined")return;SurfStreamApp.get("mainRouter").navigate("/"+SurfStreamApp.inRoom,!1),a.data.modal.hide()},show:function(){$("#room-modal").show(),$("#modalBG").show(),SocketManagerModel.loadRoomsInfo()},render:function(){return $(this.el).html(this.roomListTemplate()),this.bindButtonEvents(),this},bindButtonEvents:function(){$("#CreateRoom").bind("click",{modal:this},this.submitNewRoom),$("#CreateRoomName").bind("submit",this.submitNewRoom),$("#CreateRoomName").keypress({modal:this},function(a){a.which==13&&a.data.modal.submitNewRoom(a)}),$("#hideRoomsList").click({modal:this},this.hideByClick),$("#modalBG").click({modal:this},this.hideByClick)},submitNewRoom:function(a){var b=$("#CreateRoomName").val();if(b=="")return!1;var c=$.trim(b).replace(/\s+/g,"-");return SocketManagerModel.joinRoom(c,!0,b),typeof mpq!="undefined"&&mpq.track("Room Joined",{mp_note:"Created",source:"Created Room",roomName:b}),window.SurfStreamApp.get("mainRouter").navigate("/"+c,!1),a.data.modal.hide(),!1},addRooms:function(a){this.render(),a.each(function(a){new RoomListCellView({roomListCellModel:a})}),SurfStreamApp.stickRoomModal&&($("#hideRoomsList").css({display:"none"}),SurfStreamApp.stickRoomModal=!1,SurfStreamApp.closeRoomModalIsHidden=!0)}}),window.RoomListCellView=Backbone.View.extend({tagName:"tr",className:"room-row",roomListCellTemplate:_.template($("#roomlistCell-template #celltemplate-table .room-row").html()),videoThumbnailTemplate:_.template($("#video-thumbnail-template").html()),events:{"mouseover .room-friends-container":"displayFriends","mouseout .room-friends-container":"hideFriends","mouseover .room-history":"displayChannelHistory","mouseout .room-history":"hideChannelHistory"},initialize:function(){this.render(),$(this.el).bind("click",this.clickJoinRoom)},render:function(){var a=this.options.roomListCellModel,b=a.get("curVidTitle"),c=this.renderFriends(1,"friendInRoomPic"),d=this.renderFriends(0,"friendInRoomPicHover"),e=a.get("roomName");a.get("rID")==SurfStreamApp.inRoom&&(e="<span id='user-cur-room'>"+e+"</span>"),$(this.el).html(this.roomListCellTemplate({viewers:a.get("numUsers"),currentVideoName:b&&b.length>0?" "+b:"",roomname:e,numDJs:a.get("numDJs"),partial_friends:c,full_friends:d,truename:a.get("rID")})),a.get("valstream")||$(this.el).find(".valstream-icon").hide(),this.friendsHover=$(this.el).find(".friends-hover-container"),this.friendsDisplay=$(this.el).find(".room-friends-container"),this.channelHistory=$(this.el).find(".room-history-container"),this.videoTitle=$(this.el).find(".lastPlayedVideoTitle"),this.channelHistoryDisplayed=!1;var f=a.get("recentVids");$($("#roomsTable tbody:first")[0]).append(this.el);var g=2;b||(g=3);if(f){var h=f.length;for(var i=0;i<h&&i<g;i++){var j=this.videoThumbnailTemplate();$(this.el).find(".room-history-container").prepend(j),$(this.el).find(".room-history-container").find(".videoThumbnail:first").attr("src",ss_idToHDImg(f[i].videoId)),$(this.el).find(".room-history-container").find(".videoThumbnail:first").mouseenter({videoTitle:f[i].title},this.displayVideoTitle)}}if(b){var j=this.videoThumbnailTemplate();$(this.el).find(".room-history-container").prepend(j),$(this.el).find(".room-history-container").find(".videoThumbnail:first").attr("src",ss_idToHDImg(a.get("curVidId"))),$(this.el).find(".room-history-container").find(".videoThumbnail:first").mouseenter({videoTitle:b},this.displayVideoTitle),$(this.el).find(".room-history-container .videoThumbnailContainer:first .videoThumbnail").addClass("lastPlayedVideo"),$(this.el).find(".room-history .lastPlayedVideoTitle").text(b)}return!b&&!f&&$(this.el).find(".lastPlayedVideoTitle").prepend("No videos have been played yet. Be the first!"),this},renderFriends:function(a,b){var c="",d=this.options.roomListCellModel.get("friends");if(d.length==0)return"0";if(a==0)for(var e=0;e<d.length;e++)c+="<li class='"+b+"'</li><img src='http://graph.facebook.com/"+d[e]+"/picture' style='width:45px; height:45px;' /></li>";else for(var e=0;e<d.length&&e<a;e++)c+="<img class='"+b+"' src='http://graph.facebook.com/"+d[e]+"/picture' style='width:45px; height:45px;'>";return c},clickJoinRoom:function(a){var b=$(this).find(".true-room-name").html();if(b==SurfStreamApp.inRoom)return;var c=$(this).find(".listed-room-name").html();SocketManagerModel.joinRoom(b,!1,c),typeof mpq!="undefined"&&mpq.track("Room Joined",{mp_note:"Picked From Modal",source:"Modal",roomName:c}),window.SurfStreamApp.get("mainRouter").navigate("/"+b,!1),window.SurfStreamApp.get("mainView").roomModal.hide()},displayVideoTitle:function(a){console.log("HRM!"),$(a.currentTarget).parent().parent().find(".lastPlayedVideo").removeClass("lastPlayedVideo").css({border:"0px solid white"}),$(a.currentTarget).addClass("lastPlayedVideo").css({border:"1px solid white"}),$(a.currentTarget).parent().parent().parent().find(".lastPlayedVideoTitle").text(a.data.videoTitle)},displayFriends:function(a){if(this.options.roomListCellModel.get("friends").length==0)return;this.friendsHover.show();var b=$(a.currentTarget).offset(),c=b.top+this.friendsDisplay.height()/2-this.friendsHover.height()/2,d=b.left-this.friendsHover.width();this.friendsHover.offset({top:c,left:d})},hideFriends:function(a){this.friendsHover.hide()},displayChannelHistory:function(a){if(this.channelHistoryDisplayed)return;this.channelHistoryDisplayed=!0,this.channelHistory.show()},hideChannelHistory:function(a){if(!this.channelHistoryDisplayed)return;this.channelHistoryDisplayed=!1,this.channelHistory.hide()}}),window.ChatCellView=Backbone.View.extend({chatCellTemplate:_.template($("#chatcell-template").html()),className:"messageContainer",initialize:function(){$("#messages").append(this.render().el),window.SurfStreamApp.get("mainView").playSound("chat_message_sound")},render:function(a){return $(this.el).html(this.chatCellTemplate({username:this.options.username,msg:this.options.msg})),this}}),window.ChatCellVideoView=Backbone.View.extend({chatCellVideoTemplate:_.template($("#chatcellVideo-template").html()),className:"messageContainer",initialize:function(){$("#messages").append(this.render().el),window.SurfStreamApp.get("mainView").playSound("chat_video_sound")},render:function(a){return $(this.el).html(this.chatCellVideoTemplate({title:this.options.videoTitle,vidID:this.options.videoID})),this.$(".videoChatImg").attr("src",ss_idToImg(this.options.videoID)),this}}),window.RoomInfoView=Backbone.View.extend({el:"#roomInfo",roomInfoTemplate:_.template($("#room-info-template").html()),initialize:function(){$(this.el).html(this.roomInfoTemplate({roomName:this.options.roomName}))}}),window.TheatreView=Backbone.View.extend({el:"#room-container",initialize:function(){var a=$("#become-dj"),b=$("#remote-pullup"),c=$("#avatarWrapper_VAL");a.bind("click",{theatreView:this,playlistCollection:this.options.userModel.get("playlistCollection")},this.toggleDJStatus),a.hide(),$("#nowPlayingFull").hide(),$("#fullscreen").bind("click",{theatre:this},this.fullscreenToggle),$(document).keyup({theatre:this},function(a){a.keyCode==27&&a.data.theatre.full&&a.data.theatre.fullscreenToggle(a)}),$("#fullscreenIcon").bind("click",{theatre:this},this.fullscreenToggle),$("#lightSwitch").removeClass("down"),setTimeout(function(){$("#lightSwitch").addClass("up")},200),$("#lightSwitch").click(function(){this.className=="up"?(this.className="down",$("#dimRoom").fadeIn(),typeof mpq!="undefined"&&mpq.track("Light Turned Off")):(this.className="up",$("#dimRoom").fadeOut(),typeof mpq!="undefined"&&mpq.track("Light Turned On"))}),$(".video-div-proxy").hover(function(a){$("#fullscreenIcon").stop(),$("#now-playing-tv").stop(),$("#time-elapsed-bar").stop(),$("#fullscreenIcon, #now-playing-tv, #time-elapsed-bar").css({display:"block"}),$("#fullscreenIcon").animate({opacity:1}),$("#now-playing-tv").animate({opacity:.85}),$("#time-elapsed-bar").animate({opacity:.85})},function(a){if(a.relatedTarget)if(a.relatedTarget.id=="fullscreenIcon"||a.relatedTarget.className==".video-div-proxy")return;$("#fullscreenIcon").stop(),$("#now-playing-tv").stop(),$("#time-elapsed-bar").stop();var b=function(){$(this).css({display:"none"})};$("#fullscreenIcon").animate({opacity:0},600,"swing",b),$("#now-playing-tv").animate({opacity:0},600,"swing",b),$("#time-elapsed-bar").animate({opacity:0},600,"swing",b)}),$("#slider-line-container").bind("drag",function(a){if(a.target.id=="slider-line"||a.target.id=="slider-line-container"||a.target.id=="slider-line-full")$("#slider-ball-dot").show(),a.layerX>=98?$("#slider-ball").css({"margin-left":89}):$("#slider-ball").css({"margin-left":a.layerX+10});var b=Math.floor(($("#slider-ball").css("margin-left").replace("px","")-10)/82*100);window.YTPlayer.setVolume(b),$("#slider-line-full").css({width:b*.8})}),$("#slider-line-container").bind("dragend",function(a){$("#slider-ball-dot").hide()}),$("#slider-line-container").bind("draginit",function(a){if(a.layerX<=98){$("#slider-ball").css({"margin-left":a.layerX+10});var b=Math.floor(($("#slider-ball").css("margin-left").replace("px","")-10)/82*100);window.YTPlayer.setVolume(b),$("#slider-line-full").css({width:b*.8})}}),c.css("margin-left","410px"),c.hide(),c.data({sofaML:410}),c.data({sofaMT:0}),c.append(this.make("div",{id:"valtipsy",title:"<div style='color: #CAEDFA; font-family: \"Courier New\", Courier, monospace' >VAL, the Video Robot</div>"})),this.valChatTipsy=this.make("div",{id:"avatarChat_VAL","class":"chattip"}),c.append(this.valChatTipsy),$(this.valChatTipsy).tipsy({gravity:"sw",fade:"true",delayOut:3e3,trigger:"manual",title:function(){return this.getAttribute("latest_txt")}}),$("#valtipsy").tipsy({gravity:"n",fade:"true",html:!0}),$("#up-vote").bind("click",this.voteUp),$("#down-vote").bind("click",SocketManagerModel.voteDown),$("#upVoteFS").bind("click",this.voteUp),$("#downVoteFS").bind("click",SocketManagerModel.voteDown),$("#vol-up").bind("click",{offset:10},setVideoVolume),$("#vol-down").bind("click",{offset:-10},setVideoVolume),$("#mute").bind("click",{button:$("#mute")},mute),$("#rooms, #logo-header").bind("click",{modal:this.options.modal},function(a){$("#room-modal").css("display")=="none"?a.data.modal.show():a.data.modal.hide()}),$("#share-video-button").click(function(){typeof mpq!="undefined"&&mpq.track("Facebook Share Clicked",{source:"remote"});var a=window.SurfStreamApp.get("roomModel").get("playerModel").get("curVid");FB.ui({method:"feed",display:"popup",name:a.title,link:"www.youtube.com/watch?v="+a.videoId,description:"Watch videos with me in the "+SurfStreamApp.inRoomName+" channel on surfstream",picture:ss_idToImg(a.videoId),properties:{"Join Now! Spots limited. Promo Code FBFRIEND":{text:"www.surfstream.tv",href:document.location.toString()}},actions:[{name:"Surf With Me",link:document.URL}]},function(a){a.post_id&&typeof mpq!="undefined"&&mpq.track("Facebook Share Made",{source:"remote"})})}),this.options.modal.hide(),this.options.userCollection.bind("add",this.placeUser,this),this.options.userCollection.bind("remove",this.removeUser,this),this.chats=[],this.full=!1,$(".chatShare").live("click",function(a){typeof mpq!="undefined"&&mpq.track("Facebook Share Clicked",{source:"chat"});var b={videoId:$(a.target.parentNode).children().filter(".nowPlayingYTID").html(),title:$(a.target.parentNode).children().filter(".nowPlayingHiddenTitle").html()};FB.ui({method:"feed",display:"popup",name:b.title,link:"www.youtube.com/watch?v="+b.videoId,description:"Watch videos with me in the "+SurfStreamApp.inRoomName+" channel on surfstream",picture:ss_idToImg(b.videoId),properties:{"Join Now! Spots limited. Promo Code FBFRIEND":{text:"www.surfstream.tv",href:document.location.toString()}},actions:[{name:"Surf With Me",link:document.URL}]},function(a){a.post_id&&typeof mpq!="undefined"&&mpq.track("Facebook Share Made",{source:"chat"})})}),$("#ch-up").click({theatre:this},function(a){var b=SurfStreamApp.inRoom;a.data.theatre.flipChannel(b,!0)}),$("#ch-down").click({theatre:this},function(a){var b=SurfStreamApp.inRoom;a.data.theatre.flipChannel(b,!1)}),$("#upCh").click({theatre:this},function(a){var b=SurfStreamApp.inRoom;a.data.theatre.flipChannel(b,!0)}),$("#downCh").click({theatre:this},function(a){var b=SurfStreamApp.inRoom;a.data.theatre.flipChannel(b,!1)}),window.onfocus=function(){if(SurfStreamApp.curDJ!="VAL"){var a=$("#val_filmreel_right"),b=$("#val_filmreel_left"),c=$("#avatarWrapper_VAL");c.data("animating",!1),SurfStreamApp.reelLoop&&(clearInterval(SurfStreamApp.reelLoop),SurfStreamApp.reelLoop=!1),a.stop(),b.stop()}}},voteUp:function(){var a=window.SurfStreamApp.get("roomModel").get("playerModel").get("curVid"),b=window.SurfStreamApp.get("userModel").get("likesCollection");if(!ss_modelWithAttribute(b,"videoId",a.videoId)){var c={title:a.title,thumb:ss_idToImg(a.videoId),videoId:a.videoId,duration:a.duration,author:a.author,viewCount:a.viewCount},d=new LikesModel(c);window.SurfStreamApp.get("userModel").get("likesCollection").add(d,{at:0}),SocketManagerModel.voteUp(c)}else SocketManagerModel.voteUp()},flipChannel:function(a,b){$("#playlist-notification-container").slideUp();var c=SurfStreamApp.get("roomModel").get("roomListCollection").toArray(),d=_.map(c,function(a){return a.get("rID")}),e=_.indexOf(d,a);b?e=e-1:e=e+1,e<0&&(e=d.length-1),e==d.length&&(e=0);var f=d[e].replace(/-+/g," ");SurfStreamApp.get("mainRouter").navigate("/"+d[e],!1),SocketManagerModel.joinRoom(d[e],!1,f),typeof mpq!="undefined"&&mpq.track("Room Joined",{mp_note:"Flipped Channel "+b?"Up":"Down",source:"Remote Ch-"+b?"Up":"Down",roomName:f})},fullscreenToggle:function(a){a.data.theatre.full=!a.data.theatre.full,a.data.theatre.full?(SurfStreamApp.fullscreen=!0,typeof mpq!="undefined"&&mpq.track("Fullscreen on",{mp_note:"Fullscreen open"}),$("#YouTubePlayer").addClass("fully"),$("#fullscreenIcon").addClass("fully"),window.onmousemove=function(){console.log("movin"),window.mmTimeoutID&&window.clearTimeout(window.mmTimeoutID),$("#nowPlayingFull").fadeIn(300),$("#fullscreenIcon").fadeIn(300),window.mmTimeoutID=setTimeout(function(){$("#nowPlayingFull").fadeOut(300),$("#fullscreenIcon").fadeOut(300)},5e3)}):(SurfStreamApp.fullscreen=!1,typeof mpq!="undefined"&&mpq.track("Fullscreen off",{mp_note:"Fullscreen closed"}),$("#YouTubePlayer").removeClass("fully"),$("#fullscreenIcon").removeClass("fully"),$("#nowPlayingFull").hide(),window.mmTimeoutID&&window.clearTimeout(window.mmTimeoutID),$("#fullscreenIcon").css("display","none"),window.onmousemove=null,window.mmTimeoutID=null)},updateDJs:function(a){var b,c,d,e=[200,266,328],f=0,g=!1,h=0,i;SurfStreamApp.sofaUsers=a,this.options.userCollection.each(function(e){d=$("#avatarWrapper_"+e.get("id")),d.data("isDJ")=="1"&&(_.any(_.pluck(a,"id"),function(a){return""+a==""+e.get("id")})||(b=d.data("roomX"),c=d.data("roomY"),d.animate({"margin-top":f+70},500,"bounceout").animate({"margin-left":b,"margin-top":c},600),d.data({trueY:c}),d.data("isDJ",0)))});for(var j in a)h=h+1,d=$("#avatarWrapper_"+a[j].id),a[j].id==this.options.userModel.get("ssId")&&(g=!0),d.data("isDJ")=="0"?(d.data("isDJ","1"),i=!0,a[j].id==this.options.userModel.get("ssId")&&(d.data("isMainUser","1"),d.append("<div id='stepDown' style='width: 80px; height: 95px; position: absolute;'></div>"),$("#stepDown").append("<a id='getOff' class='getOff' z-index=30 style='display: none; position: absolute;'>Step Down</a>"),$("#stepDown").hover(function(){$("#getOff").fadeIn()},function(){$("#getOff").fadeOut()}))):(i=!1,SurfStreamApp.curDJ==a[j].id&&($("#sofa-remote").animate({left:e[j]+50,top:f[j]+70}),$("#skipContainer").animate({"margin-left":e[j],"margin-top":f+100}))),console.log("Zindex: "+d.css("z-index")),d.css("z-index",1e3),i&&d.animate({"margin-left":e[j],"margin-top":f+70},400),d.animate({"margin-top":f,"margin-left":e[j]},500,"bouncein",function(){$(this).css("z-index","2")}),d.data({sofaMT:f,sofaML:e[j]}),d.data({trueY:f});$("#avatarWrapper_VAL").show(),g?SurfStreamApp.onSofa=!0:SurfStreamApp.onSofa=!1,$("#become-dj").css("margin-left",e[h]+"px").css("margin-top",f+10+"px"),!g&&a.length!=3?$("#become-dj").show():$("#become-dj").hide()},toggleDJStatus:function(a){$("#playlist-notification-container").slideDown();if(a.data.playlistCollection.getPlaylistById(queueId).get("videos").length==0){SurfStreamApp.get("mainView").sideBarView.showVideoManagerView(),SurfStreamApp.get("mainView").sideBarView.videoManagerView.showPlaylistCollectionView(),SurfStreamApp.get("userModel").get("playlistCollection").setActivePlaylist(queueId),SurfStreamApp.get("mainView").sideBarView.videoManagerView.calculatePlaylistHeight(),a.data.theatreView.valChat("You can't play a video without any videos in your queue");return}SocketManagerModel.becomeDJ()},placeUser:function(a){new AvatarView({user:a})},valChat:function(a){$(this.valChatTipsy).attr("latest_txt",a),$(this.valChatTipsy).tipsy("show"),setTimeout(function(){$("#avatarChat_VAL").length>0&&$("#avatarChat_VAL").tipsy("hide")},3e3)},removeUser:function(a){var b=this.$("#avatarWrapper_"+a.id),c=$("#avatarChat_"+a.id),d=$("#nameDiv_"+a.id);b.data("animating",!1),c.tipsy("hide"),d.tipsy("hide"),b.remove()}},{tipsyChat:function(a,b){var c=$("#avatarChat_"+b),d=b;c.attr("latest_txt",a),c.tipsy("show"),SurfStreamApp.chatMap[b]&&clearTimeout(SurfStreamApp.chatMap[b]),SurfStreamApp.chatMap[b]=setTimeout(function(){$("#avatarChat_"+d).length>0&&c.tipsy("hide")},3e3)}}),window.AvatarView=Backbone.View.extend({initialize:function(){var a,b,c,d,e,f,g,h,a,i,j;d=this.options.user,this.el.id="avatarWrapper_"+d.id,g=d.get("avatar"),typeof SurfStreamApp.currentAvatarSettings=="undefined"&&d.id==SurfStreamApp.get("userModel").get("ssId")&&(SurfStreamApp.currentAvatarSettings=g),this.el.className="avt_"+g[0],a=AvatarView.buildBodyPart("body",g[0]),h=AvatarView.buildEyes(g[1],g[2]),i=g[3]!=0?AvatarView.buildBodyPart("glasses",g[3]):null,c=AvatarView.buildBodyPart("smile",g[4]),j=g[5]!=0?AvatarView.buildBodyPart("hat",g[5]):null,e=this.make("div",{id:"nameDiv_"+d.id,"class":"nametip",style:"position:absolute;",title:d.get("name")}),chatDiv=this.make("div",{id:"avatarChat_"+d.id,"class":"chattip"}),b=this.make("img",{"class":"smile_default default",style:"position: absolute;",src:AvatarView.defaultMouthSrc}),$(this.el).append(a).append(b).append(c).append(h[0]).append(h[1]),i&&$(this.el).append(i),j&&$(this.el).append(j),$(this.el).append(e).append(chatDiv),d.get("x")<290?f=-80:f=680,$(this.el).css("margin-left",f).css("margin-top",280).css("position","absolute").css("z-index",2),$("#people-area").prepend(this.el),$("#avatarChat_"+d.id).tipsy({gravity:"sw",fade:"true",delayOut:3e3,trigger:"manual",title:function(){return this.getAttribute("latest_txt")}}),$("#nameDiv_"+d.id).tipsy({gravity:"n",fade:"true"}),$("#avatarWrapper_"+d.id).data("isDJ","0"),console.log("margintop stored, value: "+d.get("y")),$(this.el).data({roomX:d.get("x"),roomY:d.get("y"),trueY:d.get("y")}),$(this.el).animate({"margin-top":d.get("y"),"margin-left":d.get("x"),"z-index":Math.floor(d.get("y"))},900,"expoout")}},{defaultMouthSrc:"/images/room/monsters/smiles/line.png",buildBodyPart:function(a,b,c){return ss_make("img",{src:this.bodyPartToPath(a,b),style:"position: absolute;","class":this.bodyPartToClass(a,b)})},buildEyes:function(a,b){var c=this.bodyPartToPath("eye",a);return[ss_make("img",{src:c,style:"position: absolute;","class":this.getEyeClass(a,b,!0)}),ss_make("img",{src:c,style:"position: absolute;","class":this.getEyeClass(a,b,!1)})]},getEyeClass:function(a,b,c){var d="eye_"+(c?"left":"right")+"_";switch(parseInt(a)){case 1:d=d+"cute_";break;case 2:d=d+"cartoon_";break;case 3:d=d+"blue_"}switch(parseInt(b)){case 1:d=d+"medium";break;case 2:d=d+"large"}return d},bodyPartToPath:function(a,b){var c="/images/room/monsters/";switch(a){case"body":switch(parseInt(b)){case 1:c=c+"blue.png";break;case 2:c=c+"green.png";break;case 3:c=c+"purple.png";break;case 4:c=c+"red.png";break;case 5:c=c+"yellow.png"}break;case"eye":c=c+"eyes/";switch(parseInt(b)){case 1:c=c+"cute-medium.png";break;case 2:c=c+"cartoon-medium.png";break;case 3:c=c+"blue-medium.png"}break;case"glasses":c=c+"accessories/";switch(parseInt(b)){case 1:c=c+"glasses-dark.png";break;case 2:c=c+"glasses-thick.png";break;case 3:c=c+"glasses-red.png";break;case 4:c=c+"glasses-shiny.png";break;case 5:c=c+"glasses-monocole.png"}break;case"smile":c=c+"smiles/";switch(parseInt(b)){case 1:c=c+"cucumberteeth.png";break;case 2:c=c+"openmouth.png";break;case 3:c=c+"modest.png";break;case 4:c=c+"vampireteeth.png";break;case 5:c=c+"openteeth.png"}break;case"hat":c=c+"accessories/";switch(parseInt(b)){case 1:c=c+"hat-headphones.png";break;case 2:c=c+"hat-bow.png";break;case 3:c=c+"hat-brown.png";break;case 4:c=c+"hat-horns.png"}break;default:alert("fuuu")}return c},bodyPartToClass:function(a,b){var c="";switch(a){case"body":return"";case"glasses":switch(parseInt(b)){case 1:c=c+"glasses_dark";break;case 2:c=c+"glasses_thick";break;case 3:c=c+"glasses_red";break;case 4:c=c+"glasses_shiny";break;case 5:c=c+"glasses_monocole"}break;case"smile":switch(parseInt(b)){case 1:c=c+"smile_cucumber smiley";break;case 2:c=c+"smile_openmouth smiley";break;case 3:c=c+"smile_modest smiley";break;case 4:c=c+"smile_vampire smiley";break;case 5:c=c+"smile_openteeth smiley"}break;case"hat":switch(parseInt(b)){case 1:c=c+"hat-headphones";break;case 2:c=c+"hat-bow";break;case 3:c=c+"hat-brown";break;case 4:c=c+"hat-horns"}break;default:alert("fuuu")}return c}}),window.ShareBarView=Backbone.View.extend({el:"#shareBar",shareTemplate:_.template($("#share-template").html()),initialize:function(){$(this.el).html(this.shareTemplate()),$("#shareFB").css("background-image","/images/fb_small.png"),$("#shareTwit").css("background-image","/images/twitter_small.png"),$("#shareEmail").css("background-image","/images/email_small.png"),this.link=document.URL,window.clip=new ZeroClipboard.Client,clip.setHandCursor(!0),clip.setText(this.link),$("#question-button-container").click(function(){new AvatarPickerView({justTutorial:!0}),window.avatar_picker_open_start_time=(new Date).getTime()})},events:{"click #shareFB":"fbDialog","click #shareTwit":"tweetDialog","click #shareEmail":"openEmail"},fbDialog:function(){typeof mpq!="undefined"&&mpq.track("Facebook Share Clicked",{source:"topbar"}),console.log(window.SurfStreamApp.get("roomModel").get("playerModel").get("curVid").videoId),FB.ui({method:"feed",display:"popup",name:"I'm in the "+SurfStreamApp.inRoomName+" Channel on surfstream.tv",link:document.URL,picture:ss_idToImg(window.SurfStreamApp.get("roomModel").get("playerModel").get("curVid").videoId),caption:"Come watch videos with me",description:"Now Watching: "+window.SurfStreamApp.get("roomModel").get("playerModel").get("curVid").title},function(a){a.post_id&&typeof mpq!="undefined"&&mpq.track("Facebook Share Made",{source:"topbar"})})},tweetDialog:function(){var a=575,b=400,c=($(window).width()-a)/2,d=($(window).height()-b)/2,e="http://twitter.com/share?text=I'm%20watching%20the%20"+encodeURIComponent(SurfStreamApp.inRoomName)+"%20channel%20on%20%23surfstreamtv%20-%20Now%20Playing%20"+encodeURIComponent(window.SurfStreamApp.get("roomModel").get("playerModel").get("curVid").title),f="status=1,width="+a+",height="+b+",top="+d+",left="+c;window.open(e,"twitter",f),typeof mpq!="undefined"&&mpq.track("Twitter Share Clicked",{})},openEmail:function(){window.open("mailto:friend@domainname.com?subject=Come%20to%20SurfStream.tv%20sometime!&body=God%20this%20shit%20is%20awesome!%2C%20here's%20a%20link%0A%0A"+window.location,"_parent")}}),window.SettingsView=Backbone.View.extend({el:"#settings",settingsTemplate:_.template($("#settings-template").html()),events:{"click #settings":"showSettings",mouseout:"hideSettings","click #logout":"logout"},initialize:function(){this.showingDropdown=!1,this.render(),this.userModel=this.options.userModel,$("#logout").click({settings:this},this.logout)},render:function(){$(this.el).html(this.settingsTemplate())},showSettings:function(a){$("#settings-dropdown").show(),this.showingDropdown=!0},hideSettings:function(a){$("#settings-dropdown").hide(),this.showingDropdown=!1}}),window.MainView=Backbone.View.extend({el:"body",soundTemplate:_.template($("#audio-tag-template").html()),initialize:function(){this.soundOn=!0,this.userModel=this.options.userModel,$("#getOff").live("click",function(){$("#playlist-notification-container").slideUp(),$("#stepDown").remove(),$("#getOff").remove(),$("#skipContainer").remove(),SocketManagerModel.stepDownFromDJ()}),$("img").live("mousedown",function(){return!1}),$("#contactButton").click(function(){window.open("mailto:contact@surfstream.tv","_parent")}),this.settingsDropped=!1,$("#settings").click({mainView:this},function(a){a.data.mainView.settingsDropped?($("#change-avatar").hide(),$("#edit-profile").hide(),$("#logout").hide(),a.data.mainView.settingsDropped=!1):($("#change-avatar").show(),$("#edit-profile").show(),$("#logout").show(),a.data.mainView.settingsDropped=!0)}),$("#logout").click({mainView:this},this.logout),$("#change-avatar").click(function(){typeof mpq!="undefined"&&mpq.track("Avatar Picker Opened",{}),window.avatar_picker_open_start_time=(new Date).getTime(),new AvatarPickerView}),this.maxAudioChannels=15},logout:function(a){console.log("logoutttt"),window.YTPlayer=null,userLoggedOut=!0,a.data.mainView.userModel.logout()},initializeTopBarView:function(){this.roomInfoView=new RoomInfoView({roomName:"Placeholder"}),this.shareBarView=new ShareBarView},initializeChatView:function(a,b){this.chatView=new ChatView({chatCollection:a,userModel:b})},initializeSidebarView:function(a,b,c,d,e,f){this.sideBarView=new SideBarView({searchBarModel:a,playlistCollection:b,channelHistoryCollection:c,likesCollection:d,chatCollection:e,userModel:f})},initializePlayerView:function(a,b,c,d){this.videoPlayerView=new VideoPlayerView({playerModel:a}),this.theatreView=new TheatreView({userCollection:b,userModel:c,modal:d})},initializeRoomListView:function(a,b){this.roomModal=new RoomListView({roomlistCollection:a,app:b})},initializeSounds:function(){this.audioChannels=new Array;for(var a=0;a<this.maxAudioChannels;a++)this.audioChannels[a]=new Array,this.audioChannels[a].channel=new Audio,this.audioChannels[a].finished=-1;$(document.body).append(this.soundTemplate({audio_tag_id:"chat_message_sound",audio_src:"/sounds/chat.wav"})),$(document.body).append(this.soundTemplate({audio_tag_id:"chat_video_sound",audio_src:"/sounds/click1.wav"}))},playSound:function(a){if(this.soundOn)for(var b=0;b<this.maxAudioChannels;b++){var c=new Date;if(this.audioChannels[b].finished<c.getTime()){this.audioChannels[b].finished=c.getTime()+document.getElementById(a).duration*1e3,this.audioChannels[b].channel.src=document.getElementById(a).src,this.audioChannels[b].channel.load(),this.audioChannels[b].channel.play();break}}}}),window.SocketManagerModel=Backbone.Model.extend({initialize:function(){var b,c;b=this.get("socket"),c=this.get("app");if(!b)throw"No Socket Passed to SocketManager!";console.log("Got socket. "+b);if(!c)throw"No App Passed to SocketManager!";console.log("Got app. "+c),b.on("video:sendInfo",function(a){console.log("video announced");var b,d,e,f,g,h,i,j,k,l;SurfStreamApp.curDJ=a.dj,SurfStreamApp.vidsPlayed=SurfStreamApp.vidsPlayed+1,console.log("received video, the DJ is: "+a.dj+" and has videoid: "+a.id+" and title: "+a.title+" and time start: "+a.time),$("#fullTitle").html(a.title),$("#cur-video-name").html(a.title);var m,n,o;if(a.dj==c.get("userModel").get("ssId")){var p=c.get("userModel").get("playlistCollection"),q=p.getPlaylistById(queueId);p.get("activePlaylist").get("playlistId")==queueId&&$("#video-list-container .videoListCellContainer:first").remove();var r=q.get("videos").at(0);q.get("videos").remove(r),window.SurfStreamApp.get("mainView").sideBarView.videoManagerView.playlistCollectionView.playlistView.setNotificationText()}if(!window.playerLoaded){var s={allowScriptAccess:"always",wmode:"opaque",modestbranding:1,iv_load_policy:3},t={id:"YouTubePlayer"};swfobject.embedSWF("http://www.youtube.com/apiplayer?version=3enablejsapi=1&playerapiid=YouTubePlayer","video-container","640","390","8",null,null,s,t),window.video_ID=a.id,window.secs=a.time,window.video_title=a.title,setInterval(updateTime,1e3)}else window.YTPlayer.loadVideoById(a.id,a.time),new ChatCellVideoView({username:"Now Playing: ",videoID:a.id,videoTitle:a.title}),c.get("mainView").sideBarView.chatView.chatContainer.activeScroll();$("#room-name").html(a.title),c.get("roomModel").get("userCollection").forEach(function(a){$("#avatarWrapper_"+a.get("id")).data("animating",!1),$("#avatarWrapper_"+a.get("id")+" .smiley").hide(),$("#avatarWrapper_"+a.get("id")+" .default").show()}),n=c.get("roomModel"),o=n.get("playerModel"),m=o.get("curVid");if(m){var u=new ChannelHistoryModel({title:m.title,duration:m.duration,percent:m.percent,videoId:m.videoId,author:m.author,viewCount:m.viewCount});c.get("roomModel").get("channelHistoryCollection").add(u,{at:0})}o.set({curVid:{videoId:a.id,title:a.title,duration:a.duration,percent:.5,author:a.author,viewCount:a.viewCount}}),$("#clock").show(),$("#cur-video-name").show(),$("#cur-video-time").show();var j=SurfStreamApp.curDJ==SurfStreamApp.get("userModel").get("ssId");j&&$("#skip").length==0?($("#people-area").append("<div id='skipContainer'><button id='skip'> Skip Video </button></div>"),k=$("#avatarWrapper_"+a.dj).data("sofaML"),l=$("#avatarWrapper_"+a.dj).data("sofaMT")+100,$("#skipContainer").css({"margin-left":k,"margin-top":l}),$("#skip").bind("click",skipVideo)):$("#skipContainer").remove(),g=$("#sofa-remote"),e=parseInt(g.css("left").replace("px","")),f=parseInt(g.css("top").replace("px","")),marLeft=50-(a.dj=="VAL"?20:0),marTop=70-(a.dj=="VAL"?7:0),b=$("#avatarWrapper_"+a.dj).data("sofaML")+marLeft,d=$("#avatarWrapper_"+a.dj).data("sofaMT")+marTop;var v={start:{x:e,y:f,angle:e>b?50:-50,length:.8},end:{x:b,y:d,angle:e>b?-50:50}};this.rotateRemoteSign=!this.rotateRemoteSign,h="=1800deg",i="=500deg",this.rotateRemoteSign?(h="+"+h,i="+"+i):(h="-"+h,i="-"+i),g.animate({rotate:h,path:new $.path.bezier(v)},1e3);var w=$("#val_filmreel_right"),x=$("#val_filmreel_left"),y=$("#avatarWrapper_VAL");y.data("animating",!1),SurfStreamApp.reelLoop&&(clearInterval(SurfStreamApp.reelLoop),SurfStreamApp.reelLoop=!1),w.stop(),x.stop(),$("#val_smileBody").css({display:"none"}),$("#val_body, #val_l_pupil, #val_r_pupil, #val_smile").css({display:"block"}),a.dj=="VAL"&&($("#val_l_brow").animate({rotate:"+=20deg","margin-top":"33px","margin-left":"3px"},400,"linear").delay(1e3).animate({rotate:"-=20deg","margin-top":"37px","margin-left":"0px"},400,"linear"),$("#val_r_brow").animate({rotate:"-=20deg","margin-top":"33px","margin-left":"24px"},400,"linear").delay(1e3).animate({rotate:"+=20deg","margin-top":"37px","margin-left":"24px"},400,"linear"),y.data("animating",!0),w.animate({rotate:i},3e3,"linear"),x.animate({rotate:i},3e3,"linear"),SurfStreamApp.reelLoop=setInterval(function(){y.data("animating")==!0&&(w.animate({rotate:i},3e3,"linear"),x.animate({rotate:i},3e3,"linear"))},3e3,y,w,x))}),b.on("video:stop",function(){if(!window.playerLoaded)return;console.log("video ending!"),window.YTPlayer.stopVideo(),window.YTPlayer.clearVideo()}),b.on("user:profile",function(b){c.get("userModel").set({displayName:b.ss_name,avatarImage:"https://graph.facebook.com/"+b.id+"/picture",ssId:b.ssId}),a(),console.log
("ROUTING ON "+ss_getPath(window.location)),SurfStreamApp.waitForTutorialEnd||(Backbone.history.start({pushState:!0,silent:window.SurfStreamApp.stickRoomModal}),window.SurfStreamApp.stickRoomModal&&SurfStreamApp.get("mainView").roomModal.show())}),b.on("playlist:showFBImport",function(a){console.log("IGOT CALLED IGOT CALLED")}),b.on("user:sendFBFriends",function(a){FB.api("/me/friends",c.get("userModel").sendUserFBFriends)}),b.on("playlist:initialize",function(a){if(userLoggedOut)return;c.get("userModel").initializePlaylists(a.userPlaylists,a.activePlaylistId)}),b.on("message",function(a){c.get("roomModel").get("chatCollection").add({username:strip(a.data.name),msg:strip(a.data.text)}),TheatreView.tipsyChat(a.data.text,a.data.id)}),b.on("users:announce",function(a){c.get("roomModel").updateDisplayedUsers(a)}),b.on("djs:announce",function(a){console.log("djs announced"),c.get("mainView").theatreView.updateDJs(a)}),b.on("user:firstVisit",function(){}),b.on("meter:announce",function(a){var b=0;for(var d in a.upvoteSet)a.upvoteSet[d]===!0?(b=b+1,$("#avatarWrapper_"+d+" .smiley").show(),$("#avatarWrapper_"+d+" .default").hide(),function(){var a=$("#avatarWrapper_"+d);a.data("animating",!0),function(){var b=a.data("trueY");a.data("animating")==!0&&a.animate({marginTop:b-6},500).animate({marginTop:b},500,arguments.callee)}()}()):($("#avatarWrapper_"+d).data("animating",!1),$("#avatarWrapper_"+d+" .smiley").hide(),$("#avatarWrapper_"+d+" .default").show());c.get("roomModel").get("playerModel").get("curVid")&&a.videoId!=0&&c.get("roomModel").get("playerModel").get("curVid").videoId==a.videoId&&(c.get("roomModel").get("playerModel").get("curVid").percent=a.videoPercent),c.curDJ=="VAL"&&b>0&&($("#val_smileBody").css({display:"block"}),$("#val_body, #val_l_pupil, #val_r_pupil, #val_smile").css({display:"none"}),SurfStreamApp.valSmileInterval=setTimeout(function(){$("#val_smileBody").css({display:"none"}),$("#val_body, #val_l_pupil, #val_r_pupil, #val_smile").css({display:"block"})},4e3))}),b.on("rooms:announce",function(a){var b=c.get("roomModel").get("roomListCollection");b.reset([],{silent:!0});for(var d=0;d<a.rooms.length;d++)b.add(new RoomlistCellModel(a.rooms[d]));for(var e in a.friendsRooms)if(a.friendsRooms.hasOwnProperty(e)&&a.friendsRooms[e]){var f=ss_modelWithAttribute(b,"rID",a.friendsRooms[e]);f&&f.get("friends").push(e)}b.sort()}),b.on("room:history",function(a){c.get("roomModel").get("channelHistoryCollection").reset(a),c.get("mainView").sideBarView.videoManagerView.playlistCollectionView.channelHistoryActive&&c.get("mainView").sideBarView.videoManagerView.playlistCollectionView.resetChannelHistory()}),b.on("val:sendRecs",function(a){}),b.on("avatar:change",function(a){var b=$("#avatarWrapper_"+a.userId);b.removeClass();var c=a.newAvatarArray;b.addClass("avt_"+c[0]);var d=b.children();d.remove(),avatarBody=AvatarView.buildBodyPart("body",c[0]),avatarEyes=AvatarView.buildEyes(c[1],c[2]),avatarGlasses=c[3]!=0?AvatarView.buildBodyPart("glasses",c[3]):null,avatarSmile=AvatarView.buildBodyPart("smile",c[4]),avatarTop=c[5]!=0?AvatarView.buildBodyPart("hat",c[5]):null,nameDiv=ss_make("div",{id:"nameDiv_"+a.userId,"class":"nametip",style:"position:absolute;",title:a.name}),chatDiv=ss_make("div",{id:"avatarChat_"+a.userId,"class":"chattip"}),avatarMouth=ss_make("img",{"class":"smile_default default",style:"position: absolute;",src:AvatarView.defaultMouthSrc}),b.append(avatarBody).append(avatarMouth).append(avatarSmile).append(avatarEyes[0]).append(avatarEyes[1]),avatarGlasses&&b.append(avatarGlasses),avatarTop&&b.append(avatarTop),b.append(nameDiv).append(chatDiv),$("#avatarChat_"+a.userId).tipsy({gravity:"sw",fade:"true",delayOut:3e3,trigger:"manual",title:function(){return this.getAttribute("latest_txt")}}),$("#nameDiv_"+a.userId).tipsy({gravity:"n",fade:"true"}),b.data("isDJ")=="1"&&b.data("isMainUser")=="1"&&(b.append("<div id='stepDown' style='width: 80px; height: 95px; position: absolute;'></div>"),$("#stepDown").append("<a id='getOff' class='getOff' z-index=30 style='display: none; position: absolute;'>Step Down</a>"),$("#stepDown").hover(function(){$("#getOff").fadeIn()},function(){$("#getOff").fadeOut()}))}),b.on("user:likes",function(a){c.get("userModel").get("likesCollection").reset(a)}),b.on("playlist:importFacebook",function(){c.get("userModel").importFacebook=!0})}},{socket:socket_init,startApp:function(a,b){SocketManagerModel.socket.emit("user:startApp",{fbId:a})},initializeProfile:function(a){SocketManagerModel.socket.emit("user:initializeProfile",a)},sendUserFBFriends:function(a){SocketManagerModel.socket.emit("user:sendUserFBFriends",a)},sendFBImportDate:function(a){SocketManagerModel.socket.emit("user:sendFBImportDate",a)},sendMsg:function(a){SocketManagerModel.socket.emit("message",a),typeof mpq!="undefined"&&mpq.track("Chat",{chat_text:a.text,mp_note:"User chatted "+a.text})},becomeDJ:function(){var a=SurfStreamApp.curDJ=="VAL"?!0:!1,b=SurfStreamApp.sofaUsers.length;typeof mpq!="undefined"&&mpq.track("Sofa Join",{VAL_Playing:a,mp_note:"Stepped onto sofa ("+b+" people on sofa, val playing: "+a+")"}),SocketManagerModel.socket.emit("dj:join")},stepDownFromDJ:function(){var a=SurfStreamApp.curDJ=="VAL"?!0:!1,b=SurfStreamApp.curDJ==SurfStreamApp.get("userModel").get("fbId"),c=SurfStreamApp.sofaUsers.length;typeof mpq!="undefined"&&mpq.track("Sofa Leave",{VAL_playing:a,mid_play:b,mp_note:"Stepped off of sofa ("+c+" people on sofa, val playing: "+a+", midPlay: "+b+")"}),SocketManagerModel.socket.emit("dj:quit")},addVideoToPlaylist:function(a,b,c,d,e,f,g,h){SocketManagerModel.socket.emit("playlist:addVideo",{playlistId:a,videoId:b,thumb:c,title:d,duration:e,viewCount:f,author:g,append:h})},voteUp:function(a){typeof mpq!="undefined"&&mpq.track("Vote up",{mp_note:"Video was voted up"}),SocketManagerModel.socket.emit("meter:upvote",a)},voteDown:function(){typeof mpq!="undefined"&&mpq.track("Vote down",{mp_note:"Video was voted down"}),SocketManagerModel.socket.emit("meter:downvote")},toTopOfPlaylist:function(a,b){SocketManagerModel.socket.emit("playlist:moveVideoToTop",{playlistId:a,videoId:b})},deleteFromPlaylist:function(a,b){SocketManagerModel.socket.emit("playlist:delete",{playlistId:a,videoId:b})},toIndexInPlaylist:function(a,b,c){SocketManagerModel.socket.emit("playlist:moveVideo",{playlistId:a,videoId:b,index:c})},choosePlaylist:function(a){SocketManagerModel.socket.emit("playlists:choosePlaylist",{playlistId:a})},addPlaylist:function(a,b){SocketManagerModel.socket.emit("playlists:addPlaylist",{playlistId:a,playlistName:b})},deletePlaylist:function(a){console.log(a),SocketManagerModel.socket.emit("playlists:deletePlaylist",{playlistId:a})},loadRoomsInfo:function(){SocketManagerModel.socket.emit("rooms:load",{id:window.SurfStreamApp.get("userModel").get("ssId")}),console.log(window.SurfStreamApp.get("userModel").get("ssId")),console.log("LOGGED")},joinRoom:function(a,b,c){var d=SurfStreamApp.vidsPlayed,e=SurfStreamApp.curDJ==SurfStreamApp.get("userModel").get("ssId");SurfStreamApp.vidsPlayed=0,$("#cur-room-name").html("<span style='font-weight:normal'>Channel:</span> "+c),$("#cur-video-name").hide(),$("#cur-video-time").hide(),$("#cur-video-info").css("max-width",415-$("#cur-room-name").css("width").replace("px","")),SurfStreamApp.closeRoomModalIsHidden&&($("#hideRoomsList").css({display:"block"}),SurfStreamApp.closeRoomModalIsHidden=!1),$("#clock").hide(),typeof mpq!="undefined"&&mpq.register_once({room:c});var f={rID:a};b&&(f.create=!0,f.roomName=c),SurfStreamApp.inRoom&&(f.currRoom=SurfStreamApp.inRoom),SurfStreamApp.inRoom=a,SurfStreamApp.inRoomName=c,f.fbId=window.SurfStreamApp.get("userModel").get("fbId"),f.ssId=window.SurfStreamApp.get("userModel").get("ssId"),SurfStreamApp.get("roomModel").get("chatCollection").reset(),$("#sofa-remote").css({left:"170px",top:"140px","z-index":1}),$("#skipContainer").remove(),window.SurfStreamApp.get("roomModel").updateDisplayedUsers([]),window.SurfStreamApp.get("roomModel").get("userCollection").reset(),window.YTPlayer&&(window.YTPlayer.stopVideo(),window.YTPlayer.loadVideoById(1)),window.SurfStreamApp.get("roomModel").get("playerModel").set({curVid:null}),console.log("joining room "+c),SocketManagerModel.socket.emit("room:join",f),SocketManagerModel.socket.emit("val:requestRecs"),SurfStreamApp.curDJ="__none__"},updateAvatar:function(){SocketManagerModel.socket.emit("avatar:update",{avatar:SurfStreamApp.currentAvatarSettings,name:SurfStreamApp.get("userModel").get("displayName")})}}),window.RaRouter=Backbone.Router.extend({routes:{":rID":"joinRoom"},joinRoom:function(a){var b=$.url(window.location),c=b.segment(1),d=b.param();console.log(c+" is the rID, extras are "+b.param().toString()),this.navigate(c,!1),c!=""?(SocketManagerModel.joinRoom(c,!1,c.replace(/-+/g," ")),typeof mpq!="undefined"&&mpq.track("Room Joined",{mp_note:"Landed from web link",source:"Landing",roomName:c.replace(/-+/g," ")})):SocketManagerModel.loadRoomsInfo()}}),window.playerLoaded=!1;var d=document.createElement("script");d.async=!0,d.src=document.location.protocol+"//connect.facebook.net/en_US/all.js",document.getElementById("fb-root").appendChild(d)});var soundEmbed=null;Object.size=function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b},ss_getPath=function(a){var b=document.createElement("a");return b.href=a,b.pathname};var queueId=0,facebookPlaylistId=1,userLoggedOut=!1;dummyView=Backbone.View.extend({}),ss_make=(new dummyView).make